"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[1692],{8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var r=s(6540);const i={},c=r.createContext(i);function l(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(c.Provider,{value:n},e.children)}},9920:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>x,frontMatter:()=>l,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"bella-assistants/dev/non-store-mode-architecture","title":"\u8f7b\u91cf\u7ea7\uff1a\u975eStore\u6a21\u5f0f\u8bbe\u8ba1\u4e0e\u5b9e\u73b0","description":"\u5728\u4e0d\u843d\u5e93\u7684\u524d\u63d0\u4e0b\uff0c\u5b8c\u6574\u590d\u7528 Run/Tool/State/Context \u6267\u884c\u6808\u4e0e\u6d41\u5f0f\u534f\u8bae\uff0c\u901a\u8fc7\u7ebf\u7a0b\u672c\u5730\u5185\u5b58\u6001 Repo \u63d0\u4f9b\u201c\u5373\u5f00\u5373\u7528\u3001\u8bf7\u6c42\u5185\u53ef\u89c2\u6d4b\u201d\u7684\u8f7b\u91cf\u4f53\u9a8c\u3002","source":"@site/docs/bella-assistants/dev/05-non-store-mode-architecture.md","sourceDirName":"bella-assistants/dev","slug":"/bella-assistants/dev/non-store-mode-architecture","permalink":"/docs/bella-assistants/dev/non-store-mode-architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"\u5bf9\u8bdd\u6811\uff1aresponse\u7684\u591a\u8def\u5f84\u6267\u884c","permalink":"/docs/bella-assistants/dev/dialog-branching-multipath-execution"},"next":{"title":"\u5de5\u5177\u6269\u5c55\uff1a\u5de5\u5177\u63d2\u4ef6\u7cfb\u7edf\u6df1\u5ea6\u5256\u6790","permalink":"/docs/bella-assistants/dev/tool-plugin-architecture"}}');var i=s(4848),c=s(8453);const l={},o="\u8f7b\u91cf\u7ea7\uff1a\u975eStore\u6a21\u5f0f\u8bbe\u8ba1\u4e0e\u5b9e\u73b0",d={},t=[{value:"\u8bbe\u8ba1\u76ee\u6807",id:"\u8bbe\u8ba1\u76ee\u6807",level:2},{value:"\u5f00\u542f\u4e0e\u751f\u547d\u5468\u671f",id:"\u5f00\u542f\u4e0e\u751f\u547d\u5468\u671f",level:2},{value:"\u6570\u636e\u5e73\u9762\uff1a\u5185\u5b58\u6001 RepoContext",id:"\u6570\u636e\u5e73\u9762\u5185\u5b58\u6001-repocontext",level:2},{value:"\u534f\u8bae\u4e0e\u6267\u884c\uff1a\u4e0e Store \u6a21\u5f0f\u4fdd\u6301\u4e00\u81f4",id:"\u534f\u8bae\u4e0e\u6267\u884c\u4e0e-store-\u6a21\u5f0f\u4fdd\u6301\u4e00\u81f4",level:2},{value:"\u975eStore\u8bf7\u6c42\u65f6\u5e8f",id:"\u975estore\u8bf7\u6c42\u65f6\u5e8f",level:2},{value:"\u7ea6\u675f\u4e0e\u8fb9\u754c",id:"\u7ea6\u675f\u4e0e\u8fb9\u754c",level:2},{value:"\u8d44\u6e90\u4e0e\u6027\u80fd",id:"\u8d44\u6e90\u4e0e\u6027\u80fd",level:2},{value:"\u793a\u4f8b\u8bf7\u6c42",id:"\u793a\u4f8b\u8bf7\u6c42",level:2},{value:"\u5173\u952e\u4ee3\u7801\u7d22\u5f15",id:"\u5173\u952e\u4ee3\u7801\u7d22\u5f15",level:2},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u8f7b\u91cf\u7ea7\u975estore\u6a21\u5f0f\u8bbe\u8ba1\u4e0e\u5b9e\u73b0",children:"\u8f7b\u91cf\u7ea7\uff1a\u975eStore\u6a21\u5f0f\u8bbe\u8ba1\u4e0e\u5b9e\u73b0"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u5728\u4e0d\u843d\u5e93\u7684\u524d\u63d0\u4e0b\uff0c\u5b8c\u6574\u590d\u7528 Run/Tool/State/Context \u6267\u884c\u6808\u4e0e\u6d41\u5f0f\u534f\u8bae\uff0c\u901a\u8fc7\u7ebf\u7a0b\u672c\u5730\u5185\u5b58\u6001 Repo \u63d0\u4f9b\u201c\u5373\u5f00\u5373\u7528\u3001\u8bf7\u6c42\u5185\u53ef\u89c2\u6d4b\u201d\u7684\u8f7b\u91cf\u4f53\u9a8c\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u8bbe\u8ba1\u76ee\u6807",children:"\u8bbe\u8ba1\u76ee\u6807"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u96f6\u6301\u4e45"}),"\uff1a\u8bf7\u6c42\u5185\u4e0d\u5411\u6570\u636e\u5e93\u5199\u5165\u5bf9\u8bdd\u3001Run\u3001Step\u3001\u5de5\u5177\u8bb0\u5f55\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7aef\u5230\u7aef\u6d41\u5f0f"}),"\uff1a\u652f\u6301 SSE \u6d41\u3001\u5e76\u5728\u963b\u585e\u6a21\u5f0f\u4e0b\u8fd4\u56de\u5b8c\u6574\u805a\u5408\u7ed3\u679c\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6700\u5c0f\u903b\u8f91\u5165\u4fb5"}),"\uff1a\u4ec5\u5728 Repo \u5c42\u5207\u6362\u5230\u5185\u5b58\u5b9e\u73b0\uff1b\u6267\u884c\u4e3b\u5e72\u4fdd\u6301\u4e00\u81f4\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u53ef\u5e76\u53d1"}),"\uff1a\u4fdd\u7559\u591a\u7ebf\u7a0b\u6267\u884c\u3001\u5de5\u5177\u5e76\u884c\u4e0e\u8f93\u51fa\u4e32\u884c\u5316\u80fd\u529b\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5b89\u5168\u8fb9\u754c"}),"\uff1a\u7981\u6b62\u4e0e\u5386\u53f2\u4f9d\u8d56\u8026\u5408\u7684\u80fd\u529b\uff08\u5982 previous_response_id\u3001conversation\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u5f00\u542f\u4e0e\u751f\u547d\u5468\u671f",children:"\u5f00\u542f\u4e0e\u751f\u547d\u5468\u671f"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5165\u53e3\u5f00\u5173"}),"\uff1a",(0,i.jsx)(n.code,{children:"ResponseController.createResponses()"})," \u4e2d\uff0c\u5f53 ",(0,i.jsx)(n.code,{children:"request.store == false"})," \u65f6\u8c03\u7528 ",(0,i.jsx)(n.code,{children:"RepoContext.activate()"})," \u542f\u7528\u975eStore\u6a21\u5f0f\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/controller/ResponseController.java"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u5173\u952e\u903b\u8f91\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"boolean nonStore = Boolean.FALSE.equals(request.getStore());"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"if (nonStore) RepoContext.activate();"})}),"\n",(0,i.jsxs)(n.li,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"finally"})," \u4e2d ",(0,i.jsx)(n.code,{children:"RepoContext.detach();"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u8de8\u7ebf\u7a0b\u4f20\u64ad"}),"\uff1a",(0,i.jsx)(n.code,{children:"TaskExecutor"})," \u63d0\u4ea4\u4efb\u52a1\u65f6\u6355\u83b7\u7ebf\u7a0b\u672c\u5730\u7684 ",(0,i.jsx)(n.code,{children:"RepoContext.State"})," \u5feb\u7167\uff0c\u5e76\u5728\u6267\u884c\u7ebf\u7a0b ",(0,i.jsx)(n.code,{children:"attach/detach"}),"\uff0c\u4fdd\u8bc1 runner/executor/caller \u4e09\u4e2a\u7ebf\u7a0b\u6c60\u7684\u4e00\u81f4\u4e0a\u4e0b\u6587\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/TaskExecutor.java"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u65b9\u6cd5\uff1a",(0,i.jsx)(n.code,{children:"addRunner/addExecutor/addToolSender/supplyCaller"})," \u2192 ",(0,i.jsx)(n.code,{children:"wrapWithRepoContext(...)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u751f\u547d\u5468\u671f"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RepoContext"})," \u4e3a ThreadLocal \u5bb9\u5668\uff1b\u5728\u8bf7\u6c42\u53d1\u8d77\u7ebf\u7a0b\u6fc0\u6d3b\uff0c\u63d0\u4ea4\u5230\u6267\u884c\u7ebf\u7a0b\u540e\u643a\u5e26\u5feb\u7167\uff1b\u5f53\u6240\u6709\u6267\u884c\u7ebf\u7a0b\u7ed3\u675f\u65f6\u81ea\u52a8 ",(0,i.jsx)(n.code,{children:"detach"}),"\uff0c\u5185\u5b58\u6570\u636e\u968f\u4e4b\u91ca\u653e\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u975eStore\u6a21\u5f0f\u4e0b\u7684\u5b9e\u4f53\u4ec5\u5728\u672c\u6b21\u6267\u884c\u7684\u76f8\u5173\u7ebf\u7a0b\u5185\u53ef\u89c1\uff0c\u4e0d\u5bf9\u540e\u7eed\u8bf7\u6c42\u53ef\u89c1\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u6570\u636e\u5e73\u9762\u5185\u5b58\u6001-repocontext",children:"\u6570\u636e\u5e73\u9762\uff1a\u5185\u5b58\u6001 RepoContext"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b58\u50a8\u7ed3\u6784"}),"\uff1a",(0,i.jsx)(n.code,{children:"RepoContext.Store"})," \u63d0\u4f9b\u5185\u5b58 Map \u4f5c\u4e3a\u201c\u8f7b\u91cf\u6570\u636e\u5e93\u201d\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/db/context/RepoContext.java"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u7ef4\u62a4\u5b9e\u4f53\uff1a",(0,i.jsx)(n.code,{children:"threads/messages/runs/runSteps/runTools/responseIdMappings/threadFiles"}),"\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u63d0\u4f9b\u8f7b\u91cf\u67e5\u8be2\uff1a\u6309\u65f6\u95f4\u6392\u5e8f\u3001\u6e38\u6807\u5206\u9875\u3001\u8303\u56f4\u7b5b\u9009\u7b49\u5e38\u7528\u65b9\u6cd5\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Repo \u9009\u62e9\u903b\u8f91"}),"\uff1a\u5404 Repo \u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"BaseRepo.isNoStoreMode()"})," \u5224\u5b9a\u662f\u5426\u8d70\u5185\u5b58\u6001\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/db/repo/BaseRepo.java"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u793a\u4f8b\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MessageRepo.findById(...)"})," \u5728\u975eStore\u65f6\u8c03\u7528 ",(0,i.jsx)(n.code,{children:"getContextStore().findMessageById(...)"}),"\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ResponseIdMappingRepo.findByResponseId(...)"}),"\u3001",(0,i.jsx)(n.code,{children:"findByPreviousResponseId(...)"})," \u540c\u7406\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u534f\u8bae\u4e0e\u6267\u884c\u4e0e-store-\u6a21\u5f0f\u4fdd\u6301\u4e00\u81f4",children:"\u534f\u8bae\u4e0e\u6267\u884c\uff1a\u4e0e Store \u6a21\u5f0f\u4fdd\u6301\u4e00\u81f4"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6267\u884c\u4e3b\u5e72"}),"\uff1a\u5b8c\u5168\u590d\u7528 ",(0,i.jsx)(n.code,{children:"RunExecutor.executeRun()"})," \u7684\u89c4\u5212/\u6267\u884c\u5faa\u73af\u3001\u5de5\u5177\u5e76\u884c\u4e0e\u6d88\u606f\u6d41\u8f6c\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/run/RunExecutor.java"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u7ec4\u4ef6\uff1a",(0,i.jsx)(n.code,{children:"Planner"}),"\u3001",(0,i.jsx)(n.code,{children:"ChatService"}),"\u3001",(0,i.jsx)(n.code,{children:"ToolExecutor"}),"\u3001",(0,i.jsx)(n.code,{children:"RunStateManager"}),"\u3001",(0,i.jsx)(n.code,{children:"ExecutionContext"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Responses \u6d41\u5f0f\u6620\u5c04"}),"\uff1a",(0,i.jsx)(n.code,{children:"ResponseMessageExecutor"})," \u8d1f\u8d23\u5c06 ChatCompletion \u589e\u91cf\u4e0e\u5de5\u5177\u8f93\u51fa\u6620\u5c04\u4e3a Responses SSE \u4e8b\u4ef6\u4e0e\u6700\u7ec8 ",(0,i.jsx)(n.code,{children:"Response"})," \u805a\u5408\u5bf9\u8c61\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/run/ResponseMessageExecutor.java"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u662f\u5426\u843d\u5e93\u6807\u8bc6"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ResponseUtils.convertToRunRequest(...)"})," \u5c06 ",(0,i.jsx)(n.code,{children:"request.store"})," \u5199\u5165 ",(0,i.jsx)(n.code,{children:"run.metadata[STORE]"}),"\uff0c\u5e76\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"saveMessage"}),"\uff08\u4f9b\u6d88\u606f\u843d\u5e93\u7b56\u7565\u4f7f\u7528\uff09\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/util/ResponseUtils.java"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ExecutionContext.isStore()"})," \u57fa\u4e8e ",(0,i.jsx)(n.code,{children:"run.metadata[STORE]"})," \u5224\u5b9a\uff08\u9ed8\u8ba4 true\uff09\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/run/ExecutionContext.java"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"additional_messages \u7b56\u7565"}),"\uff1a\u975eStore\u65f6\uff0c",(0,i.jsx)(n.code,{children:"RunService.doCreateRun(...)"})," \u5728\u521b\u5efa additional messages \u65f6\u4f20\u5165 ",(0,i.jsx)(n.code,{children:"hidden = (Boolean.FALSE == request.getSaveMessage())"}),"\uff0c\u5b9e\u73b0\u201c\u8bf7\u6c42\u5185\u53ef\u89c1\u3001\u5bf9\u5916\u4e0d\u66b4\u9732\u201d\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4ee3\u7801\uff1a",(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/service/RunService.java"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u975estore\u8bf7\u6c42\u65f6\u5e8f",children:"\u975eStore\u8bf7\u6c42\u65f6\u5e8f"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n  autonumber\n  participant Client\n  participant RC as ResponseController\n  participant RS as ResponseService\n  participant RRun as RunService\n  participant Exec as RunExecutor\n  participant Msg as ResponseMessageExecutor\n\n  Client->>RC: POST /v1/responses { store:false, stream:true }\n  RC->>RC: RepoContext.activate()\n  RC->>RS: createResponse(request)\n  RS->>RRun: createRun(threadId, runId, runRequest, ...)\n  RC->>Exec: startResponseRun(..., response, emitter)\n  Exec->>Msg: start(context)\n  loop executeLoop\n    Exec->>LLM: chat(stream=true)\n    LLM--\x3e>Msg: ChatCompletionChunk / Tool calls\n    Msg--\x3e>Msg: Responses SSE events\n  end\n  RC--\x3e>Client: SseEmitter\n  Note over Exec,Msg: \u4efb\u52a1\u7ebf\u7a0b\u4e2dRepoContext\u7531TaskExecutor\u81ea\u52a8attach/detach"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u7ea6\u675f\u4e0e\u8fb9\u754c",children:"\u7ea6\u675f\u4e0e\u8fb9\u754c"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5386\u53f2\u4f9d\u8d56\u7981\u7528"}),"\uff1a\u975eStore\u6a21\u5f0f\u4e0b\u4e0d\u652f\u6301\u5386\u53f2\u4f9d\u8d56\u578b\u80fd\u529b\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"previous_response_id"}),"\u3001",(0,i.jsx)(n.code,{children:"conversation"})," \u4e0e ",(0,i.jsx)(n.code,{children:"store:false"})," \u4e92\u65a5\uff08\u53c2\u6570\u6821\u9a8c\u5728 ",(0,i.jsx)(n.code,{children:"ResponseService.createResponse(...)"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u67e5\u8be2\u9650\u5236"}),"\uff1a\u8bf7\u6c42\u5b8c\u6210\u540e\uff0c\u5185\u5b58\u6001\u6570\u636e\u968f\u7ebf\u7a0b\u7ed3\u675f\u91ca\u653e\uff1b\u56e0\u6b64\u4e0d\u4fdd\u8bc1 ",(0,i.jsx)(n.code,{children:"GET /v1/responses/{id}"})," \u7b49\u67e5\u8be2\u53ef\u7528\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u540e\u53f0\u6267\u884c"}),"\uff1a",(0,i.jsx)(n.code,{children:"background:true"})," + \u975eStore \u65e0\u6cd5\u5728\u4e8b\u540e\u62c9\u53d6\u7ed3\u679c\uff1b\u5982\u9700\u7ed3\u679c\uff0c\u8bf7\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"stream:true"})," \u6216\u963b\u585e\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff0c\u5728 ",(0,i.jsx)(n.code,{children:"stream:false && background:false"}),"\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6301\u4e45\u5316\u526f\u4f5c\u7528"}),"\uff1a\u6240\u6709\u5199\u64cd\u4f5c\u4ec5\u4f5c\u7528\u4e8e ",(0,i.jsx)(n.code,{children:"RepoContext.Store"}),"\uff0c\u4e0d\u5f71\u54cd\u6570\u636e\u5e93\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u8d44\u6e90\u4e0e\u6027\u80fd",children:"\u8d44\u6e90\u4e0e\u6027\u80fd"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5185\u5b58\u5360\u7528"}),"\uff1a\u6570\u636e\u4ec5\u5728\u6267\u884c\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u5185\u5e38\u9a7b\uff1b\u65e0\u989d\u5916 LRU/\u6301\u4e45\u5316\u7b56\u7565\uff08\u7531\u751f\u547d\u5468\u671f\u81ea\u7136\u56de\u6536\uff09\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u541e\u5410\u4e0e\u9694\u79bb"}),"\uff1a\u4fdd\u7559 Bulkhead \u7ebf\u7a0b\u6c60\u9694\u79bb\uff1a","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Runner\uff1a",(0,i.jsx)(n.code,{children:"bella-runner-*"})]}),"\n",(0,i.jsxs)(n.li,{children:["Executor\uff1a",(0,i.jsx)(n.code,{children:"bella-executor-*"})]}),"\n",(0,i.jsxs)(n.li,{children:["Caller\uff08\u5de5\u5177\u6267\u884c/\u53d1\u9001\uff09\uff1a",(0,i.jsx)(n.code,{children:"bella-caller-*"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u793a\u4f8b\u8bf7\u6c42",children:"\u793a\u4f8b\u8bf7\u6c42"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6d41\u5f0f\u975eStore"}),"\uff08\u63a8\u8350\uff09\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "model": "gpt-5-nano",\n  "input": "\u8bf7\u7528100\u5b57\u603b\u7ed3\u8fd9\u4e2a\u8bdd\u9898",\n  "store": false,\n  "stream": true\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u963b\u585e\u975eStore"}),"\uff08\u8fd4\u56de\u805a\u5408 ",(0,i.jsx)(n.code,{children:"Response"})," \u5bf9\u8c61\uff09\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "model": "gpt-5-nano",\n  "input": "\u89e3\u91ca\u521a\u624d\u7684\u4e09\u4e2a\u8981\u70b9",\n  "store": false,\n  "stream": false,\n  "background": false\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u5173\u952e\u4ee3\u7801\u7d22\u5f15",children:"\u5173\u952e\u4ee3\u7801\u7d22\u5f15"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u63a7\u5236\u5c42","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/controller/ResponseController.java"}),"\uff08\u542f\u7528/\u5173\u95ed RepoContext\uff1bSSE/\u963b\u585e/\u540e\u53f0\u8fd4\u56de\u7b56\u7565\uff09"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6267\u884c\u4e0e\u6d88\u606f","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/run/RunExecutor.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/run/ExecutionContext.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/run/ResponseMessageExecutor.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/core/TaskExecutor.java"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Repo \u4e0e\u6570\u636e","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/db/context/RepoContext.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/db/repo/BaseRepo.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/db/repo/MessageRepo.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/db/repo/ResponseIdMappingRepo.java"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u534f\u8bae\u4e0e\u9002\u914d","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/util/ResponseUtils.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/service/RunService.java"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"api/src/main/java/com/ke/assistant/service/MessageService.java"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u5c0f\u7ed3",children:"\u5c0f\u7ed3"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u975eStore\u6a21\u5f0f\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"RepoContext"})," \u5c06\u6240\u6709\u6570\u636e\u64cd\u4f5c\u9650\u5b9a\u5728\u8bf7\u6c42\u751f\u547d\u5468\u671f\u5185\uff0c\u907f\u514d\u843d\u5e93\u4e0e\u540e\u7eed\u53ef\u89c1\u6027\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"\u4e3b\u6267\u884c\u6808\uff08\u89c4\u5212/\u6d41\u5f0f/\u5de5\u5177\u5e76\u884c/\u72b6\u6001\u673a\uff09\u96f6\u6539\u52a8\u590d\u7528\uff0c\u7ed3\u5408\u7ebf\u7a0b\u6c60\u9694\u79bb\u4fdd\u6301\u7a33\u5b9a\u541e\u5410\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5efa\u8bae\u4e0e Responses \u6d41\u5f0f\u4f7f\u7528\uff0c\u6216\u963b\u585e\u83b7\u53d6\u805a\u5408\u7ed3\u679c\uff1b\u907f\u514d\u4e0e\u5386\u53f2\u4f9d\u8d56\u3001\u540e\u53f0\u6267\u884c\u7b49\u201c\u4e8b\u540e\u67e5\u8be2\u201d\u573a\u666f\u642d\u914d\u3002"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);