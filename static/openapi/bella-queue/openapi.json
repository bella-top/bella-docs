{
  "openapi": "3.0.3",
  "info": {
    "title": "Bella-Queue API",
    "version": "1.0"
  },
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "paths": {
    "/v1/queue/register": {
      "post": {
        "tags": [
          "Queue API"
        ],
        "summary": "æ³¨å†Œé˜Ÿåˆ—",
        "operationId": "registerQueue",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterQueueRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "æ³¨å†ŒæˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "description": "è¿”å›æ³¨å†Œçš„é˜Ÿåˆ—åç§°",
                  "example": "test-queue"
                }
              }
            }
          }
        }
      }
    },
    "/v1/queue/put": {
      "post": {
        "tags": [
          "Queue API"
        ],
        "summary": "æäº¤ä»»åŠ¡",
        "description": "å°†ä»»åŠ¡æäº¤åˆ°æŒ‡å®šé˜Ÿåˆ—è¿›è¡Œå¤„ç†ï¼Œæ”¯æŒcallbackã€blockingã€streamingä¸‰ç§å“åº”æ¨¡å¼",
        "operationId": "putTask",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PutTaskRequest"
              },
              "examples": {
                "callback_mode": {
                  "summary": "Callbackæ¨¡å¼è¯·æ±‚",
                  "description": "å¼‚æ­¥å¤„ç†ï¼Œå®Œæˆåå›è°ƒæŒ‡å®šURL",
                  "value": {
                    "queue": "test-queue",
                    "endpoint": "/v1/chat/completions",
                    "level": 1,
                    "data": {
                      "model": "deepseek-r1-20250401",
                      "messages": [
                        {
                          "role": "user",
                          "content": "ä½ å¥½"
                        }
                      ],
                      "stream": false
                    },
                    "callback_url": "http://localhost:8081/test/callback"
                  }
                },
                "blocking_mode": {
                  "summary": "Blockingæ¨¡å¼è¯·æ±‚",
                  "description": "åŒæ­¥ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è¿”å›ç»“æœ",
                  "value": {
                    "queue": "test-queue",
                    "endpoint": "/v1/chat/completions",
                    "level": 0,
                    "data": {
                      "model": "deepseek-r1-20250401",
                      "messages": [
                        {
                          "role": "user",
                          "content": "ä½ å¥½"
                        }
                      ],
                      "stream": false
                    },
                    "response_mode": "blocking",
                    "timeout": 300
                  }
                },
                "streaming_mode": {
                  "summary": "Streamingæ¨¡å¼è¯·æ±‚",
                  "description": "è¿”å›Server-Sent Eventsæµ",
                  "value": {
                    "queue": "test-queue",
                    "endpoint": "/v1/chat/completions",
                    "level": 0,
                    "data": {
                      "model": "deepseek-r1-20250401",
                      "messages": [
                        {
                          "role": "user",
                          "content": "ä½ å¥½"
                        }
                      ],
                      "stream": true
                    },
                    "response_mode": "streaming",
                    "timeout": 300
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ä»»åŠ¡æäº¤æˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/CallbackResponse"
                    },
                    {
                      "$ref": "#/components/schemas/BlockingResponse"
                    }
                  ]
                },
                "examples": {
                  "callback_response": {
                    "summary": "Callbackæ¨¡å¼å“åº”",
                    "description": "å¼‚æ­¥å¤„ç†æ¨¡å¼ï¼Œç«‹å³è¿”å›ä»»åŠ¡ID",
                    "value": {
                      "code": 200,
                      "timestamp": 1762856201269,
                      "data": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
                    }
                  },
                  "blocking_response": {
                    "summary": "Blockingæ¨¡å¼å“åº”",
                    "description": "åŒæ­¥ç­‰å¾…æ¨¡å¼ï¼Œç›´æ¥è¿”å›Workerå¤„ç†åçš„åŸå§‹å†…å®¹",
                    "value": {
                      "id": "chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
                      "object": "chat.completion",
                      "created": 1762857979,
                      "model": "deepseek-r1-20250401",
                      "choices": [
                        {
                          "index": 0,
                          "message": {
                            "role": "assistant",
                            "content": "\nä½ å¥½å‘€ï¼ğŸ‘‹ å¾ˆé«˜å…´è§åˆ°ä½ ï½  \næˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œéšæ—¶å‡†å¤‡å¸®ä½ è§£ç­”é—®é¢˜ã€æ•´ç†èµ„æ–™æˆ–é™ªä½ èŠèŠæœ‰è¶£çš„è¯é¢˜ã€‚æœ‰ä»€ä¹ˆæƒ³èŠçš„ï¼Œæˆ–è€…éœ€è¦å¸®å¿™çš„å—ï¼Ÿæ¯”å¦‚ï¼š  \n- ç”Ÿæ´»å°çƒ¦æ¼ï¼Ÿ ğŸ“š  \n- å­¦ä¹ /å·¥ä½œä¸Šçš„ç–‘é—®ï¼Ÿ ğŸ’¡  \n- æƒ³æ¢ç´¢æŸä¸ªçŸ¥è¯†é¢†åŸŸï¼Ÿ ğŸŒ  \n- æˆ–è€…å•çº¯æƒ³æ”¾æ¾èŠèŠï¼Ÿ ğŸ˜„  \n\nç­‰ä½ å¼€å£å•¦ï½ âœ¨",
                            "tool_calls": [],
                            "reasoning_content": "ç”¨æˆ·å‘æ¥ç®€å•çš„é—®å€™"
                          },
                          "finish_reason": "stop"
                        }
                      ],
                      "usage": {
                        "prompt_tokens": 4,
                        "total_tokens": 307,
                        "completion_tokens": 303
                      }
                    }
                  }
                }
              },
              "text/event-stream": {
                "schema": {
                  "$ref": "#/components/schemas/StreamingResponse"
                },
                "examples": {
                  "streaming_response": {
                    "summary": "Streamingæ¨¡å¼å“åº”",
                    "description": "Server-Sent Eventsæµå¼å“åº”",
                    "value": "data: {\"id\":\"chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\"object\":\"chat.completion.chunk\",\"created\":1762858384,\"model\":\"deepseek-r1-20250401\",\"choices\":[{\"index\":0,\"delta\":{\"role\":\"assistant\",\"content\":\"\"},\"logprobs\":null,\"finish_reason\":null}]}\n\ndata: {\"id\":\"chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\"object\":\"chat.completion.chunk\",\"created\":1762858384,\"model\":\"deepseek-r1-20250401\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"ä½ å¥½\"},\"logprobs\":null,\"finish_reason\":null}]}\n\ndata: [DONE]"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/queue/take": {
      "post": {
        "tags": [
          "Queue API"
        ],
        "summary": "è·å–ä»»åŠ¡",
        "description": "Workerä»æŒ‡å®šé˜Ÿåˆ—æ‹‰å–å¾…å¤„ç†ä»»åŠ¡",
        "operationId": "takeTask",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TakeTaskRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "æ‹‰å–æˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TakeTaskResponse"
                },
                "examples": {
                  "offline_task_response": {
                    "summary": "ç¦»çº¿ä»»åŠ¡å“åº”ç¤ºä¾‹",
                    "description": "level=1çš„ç¦»çº¿ä»»åŠ¡ï¼ŒåŒ…å«batch_idå’Œtrace_id",
                    "value": {
                      "test-queue:1": [
                        {
                          "ak": "xxx",
                          "endpoint": "/v1/chat/completions",
                          "queue": "test-queue",
                          "level": 1,
                          "data": {
                            "model": "deepseek-r1-20250401",
                            "messages": [
                              {
                                "role": "user",
                                "content": "ä½ å¥½"
                              }
                            ],
                            "stream": false
                          },
                          "status": "waiting",
                          "task_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
                          "batch_id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
                          "trace_id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
                          "start_time": 1762863595000,
                          "running_time": 0,
                          "expire_time": 1762949994000,
                          "completed_time": 0,
                          "callback_url": "",
                          "response_mode": "batch"
                        }
                      ]
                    }
                  },
                  "online_task_response": {
                    "summary": "åœ¨çº¿ä»»åŠ¡å“åº”ç¤ºä¾‹",
                    "description": "level=0çš„åœ¨çº¿ä»»åŠ¡ï¼ŒåŒ…å«instance_id",
                    "value": {
                      "test-queue:0": [
                        {
                          "ak": "xxx",
                          "endpoint": "/v1/chat/completions",
                          "queue": "test-queue",
                          "level": 0,
                          "data": {
                            "model": "deepseek-r1-20250401",
                            "messages": [
                              {
                                "role": "user",
                                "content": "ä½ å¥½"
                              }
                            ],
                            "stream": false
                          },
                          "status": "waiting",
                          "task_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
                          "instance_id": "xx.xx.xx.xx:xxx",
                          "start_time": 1762863595000,
                          "running_time": 0,
                          "expire_time": 1762949994000,
                          "completed_time": 0,
                          "callback_url": "",
                          "response_mode": "blocking"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/queue/{taskId}/complete": {
      "post": {
        "tags": [
          "Queue API"
        ],
        "summary": "å®Œæˆä»»åŠ¡",
        "description": "Workeræ ‡è®°ä»»åŠ¡ä¸ºå®ŒæˆçŠ¶æ€å¹¶æäº¤å¤„ç†ç»“æœ",
        "operationId": "completeTask",
        "parameters": [
          {
            "name": "taskId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ä»»åŠ¡ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CompleteTaskRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ä»»åŠ¡å®ŒæˆæˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "description": "è¿”å›ä»»åŠ¡ID",
                  "example": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
                }
              }
            }
          }
        }
      }
    },
    "/v1/queue/{taskId}/cancel": {
      "post": {
        "tags": [
          "Queue API"
        ],
        "summary": "å–æ¶ˆä»»åŠ¡",
        "description": "å–æ¶ˆæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œ",
        "operationId": "cancelTask",
        "parameters": [
          {
            "name": "taskId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ä»»åŠ¡ID"
          }
        ],
        "responses": {
          "200": {
            "description": "ä»»åŠ¡å–æ¶ˆæˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "description": "è¿”å›å–æ¶ˆçš„ä»»åŠ¡ID",
                  "example": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
                }
              }
            }
          }
        }
      }
    },
    "/v1/queue/{fullQueueName}/stats": {
      "get": {
        "tags": [
          "Queue API"
        ],
        "summary": "è·å–é˜Ÿåˆ—ç»Ÿè®¡",
        "description": "è·å–æŒ‡å®šé˜Ÿåˆ—çš„ç»Ÿè®¡ä¿¡æ¯",
        "operationId": "getQueueStats",
        "parameters": [
          {
            "name": "fullQueueName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "å®Œæ•´çš„é˜Ÿåˆ—åç§°ï¼ˆqueueName:levelï¼‰"
          }
        ],
        "responses": {
          "200": {
            "description": "é˜Ÿåˆ—ç»Ÿè®¡ä¿¡æ¯",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetailedQueueStatsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/queue/eventbus": {
      "get": {
        "tags": [
          "Queue API"
        ],
        "summary": "è·å–EventBusé…ç½®",
        "description": "è·å–Redis EventBusè¿æ¥é…ç½®ï¼Œç”¨äºå®æ—¶ä»»åŠ¡é€šä¿¡",
        "operationId": "getEventBusConfig",
        "responses": {
          "200": {
            "description": "EventBusé…ç½®",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EventBusConfigResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/batches": {
      "post": {
        "tags": [
          "Batch API"
        ],
        "summary": "åˆ›å»ºæ‰¹å¤„ç†ä»»åŠ¡",
        "operationId": "createBatch",
        "parameters": [
          {
            "name": "X-BELLA-QUEUE-NAME",
            "in": "header",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "æŒ‡å®šå¤„ç†æ‰¹æ¬¡çš„é˜Ÿåˆ—åç§°ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™æ ¹æ®æ¨¡å‹è‡ªåŠ¨è·¯ç”±ï¼‰"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBatchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "æ‰¹é‡ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateBatchResponse"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Batch API"
        ],
        "summary": "åˆ—å‡ºæ‰¹å¤„ç†ä»»åŠ¡",
        "description": "è·å–æ‰¹é‡ä»»åŠ¡åˆ—è¡¨",
        "operationId": "listBatches",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer"
            },
            "description": "è¿”å›æ•°é‡é™åˆ¶"
          },
          {
            "name": "after",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "æŸ¥è¯¢å¼€å§‹ä½ç½®"
          }
        ],
        "responses": {
          "200": {
            "description": "æ‰¹é‡ä»»åŠ¡åˆ—è¡¨",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListBatchesResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/batches/{batch_id}": {
      "get": {
        "tags": [
          "Batch API"
        ],
        "summary": "è·å–æ‰¹å¤„ç†ä»»åŠ¡è¯¦æƒ…",
        "description": "è·å–æŒ‡å®šæ‰¹é‡ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯",
        "operationId": "retrieveBatch",
        "parameters": [
          {
            "name": "batch_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "æ‰¹é‡ä»»åŠ¡ID"
          }
        ],
        "responses": {
          "200": {
            "description": "æ‰¹é‡ä»»åŠ¡è¯¦æƒ…",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/batches/{batch_id}/cancel": {
      "post": {
        "tags": [
          "Batch API"
        ],
        "summary": "å–æ¶ˆæ‰¹å¤„ç†ä»»åŠ¡",
        "description": "å–æ¶ˆæŒ‡å®šçš„æ‰¹é‡ä»»åŠ¡",
        "operationId": "cancelBatch",
        "parameters": [
          {
            "name": "batch_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "æ‰¹é‡ä»»åŠ¡ID"
          }
        ],
        "responses": {
          "202": {
            "description": "æ‰¹é‡ä»»åŠ¡å–æ¶ˆè¯·æ±‚å·²æ¥å—",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CancelBatchResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/console/{fullQueueName}/clear": {
      "post": {
        "tags": [
          "Console API"
        ],
        "summary": "æ¸…ç©ºé˜Ÿåˆ—",
        "description": "æ¸…ç©ºæŒ‡å®šé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡",
        "operationId": "clearQueue",
        "parameters": [
          {
            "name": "fullQueueName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "è¦æ¸…ç©ºçš„é˜Ÿåˆ—å®Œæ•´åç§°"
          }
        ],
        "responses": {
          "200": {
            "description": "é˜Ÿåˆ—æ¸…ç©ºæˆåŠŸ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "description": "è¿”å›æ¸…ç©ºçš„é˜Ÿåˆ—åç§°",
                  "example": "test-queue:1"
                }
              }
            }
          }
        }
      }
    },
    "/v1/console/queue/stats": {
      "get": {
        "tags": [
          "Console API"
        ],
        "summary": "è·å–æ‰€æœ‰é˜Ÿåˆ—ç»Ÿè®¡",
        "description": "è·å–ç³»ç»Ÿä¸­æ‰€æœ‰é˜Ÿåˆ—çš„ç»Ÿè®¡ä¿¡æ¯",
        "operationId": "getAllQueueStats",
        "responses": {
          "200": {
            "description": "æ‰€æœ‰é˜Ÿåˆ—ç»Ÿè®¡ä¿¡æ¯",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DetailedQueueStatsResponse"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "Bearer tokenè®¤è¯"
      }
    },
    "schemas": {
      "RegisterQueueRequest": {
        "type": "object",
        "properties": {
          "queue": {
            "type": "string",
            "description": "é˜Ÿåˆ—åç§°ï¼ˆåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€åˆ†éš”ç¬¦ï¼Œé•¿åº¦ä¸è¶…è¿‡64å­—ç¬¦ï¼‰",
            "maxLength": 64,
            "example": "test-queue"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹",
            "example": "/v1/chat/completions"
          }
        },
        "required": [
          "queue",
          "endpoint"
        ]
      },
      "PutTaskRequest": {
        "type": "object",
        "properties": {
          "queue": {
            "type": "string",
            "description": "é˜Ÿåˆ—åç§°",
            "example": "test-queue"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹",
            "example": "/v1/chat/completions"
          },
          "level": {
            "type": "integer",
            "description": "é˜Ÿåˆ—çº§åˆ«ï¼š0(åœ¨çº¿é˜Ÿåˆ—)ã€1(ç¦»çº¿é˜Ÿåˆ—)",
            "enum": [
              0,
              1
            ],
            "example": 1
          },
          "data": {
            "type": "object",
            "description": "ä»»åŠ¡æ•°æ®è½½è·ï¼Œå‚è€ƒOpenAPIä½¿ç”¨æ–‡æ¡£ï¼šhttps://doc.bella.top/docs/bella-openapi/core/chat-completions",
            "example": {
              "model": "deepseek-r1-20250401",
              "messages": [
                {
                  "role": "user",
                  "content": "ä½ å¥½"
                }
              ],
              "stream": false
            }
          },
          "response_mode": {
            "type": "string",
            "enum": [
              "blocking",
              "streaming",
              "callback"
            ],
            "description": "å“åº”æ¨¡å¼ï¼šblocking(é˜»å¡)ã€streaming(æµå¼)ã€callback(å›è°ƒ)ï¼Œé»˜è®¤callback",
            "example": "callback"
          },
          "callback_url": {
            "type": "string",
            "description": "å›è°ƒURL(callbackæ¨¡å¼æ—¶ä½¿ç”¨)",
            "example": "http://localhost:8081/test/callback"
          },
          "timeout": {
            "type": "integer",
            "description": "ä»»åŠ¡è¶…æ—¶æ—¶é—´(ç§’)ï¼Œblocking/streamingæ¨¡å¼é»˜è®¤300ç§’ï¼Œcallbackæ¨¡å¼é»˜è®¤24å°æ—¶",
            "example": 300
          }
        },
        "required": [
          "queue",
          "endpoint",
          "level",
          "data"
        ]
      },
      "TakeTaskRequest": {
        "type": "object",
        "properties": {
          "queues": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "è¦è·å–ä»»åŠ¡çš„é˜Ÿåˆ—åç§°åˆ—è¡¨(æ ¼å¼: \"queueName:level\")",
            "example": [
              "test-queue:1"
            ]
          },
          "strategy": {
            "type": "string",
            "enum": [
              "fifo",
              "round_robin",
              "active_passive",
              "sequential"
            ],
            "description": "é˜Ÿåˆ—ç­–ç•¥: fifoã€round_robinã€active_passiveã€sequentialï¼Œé»˜è®¤fifo",
            "example": "active_passive"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹",
            "example": "/v1/chat/completions"
          },
          "size": {
            "type": "integer",
            "description": "è·å–ä»»åŠ¡æ•°",
            "example": 1
          }
        },
        "required": [
          "queues",
          "size"
        ]
      },
      "CompleteTaskRequest": {
        "type": "object",
        "description": "ä»»åŠ¡å®Œæˆè¯·æ±‚æ•°æ®",
        "properties": {
          "data": {
            "type": "object",
            "description": "ä»»åŠ¡å¤„ç†ç»“æœæ•°æ®",
            "example": {
              "request_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
              "status_code": 200,
              "body": {
                "// Workerå¤„ç†ç»“æœ - chat completionå“åº”": "",
                "id": "chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
                "object": "chat.completion",
                "created": 1762857979,
                "model": "deepseek-r1-20250401",
                "choices": [
                  {
                    "index": 0,
                    "message": {
                      "role": "assistant",
                      "content": "ä½ å¥½å‘€ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹"
                    },
                    "finish_reason": "stop"
                  }
                ],
                "usage": {
                  "prompt_tokens": 4,
                  "total_tokens": 307,
                  "completion_tokens": 303
                }
              }
            }
          }
        },
        "required": ["data"]
      },
      "CreateBatchRequest": {
        "type": "object",
        "properties": {
          "input_file_id": {
            "type": "string",
            "description": "è¾“å…¥æ–‡ä»¶IDï¼ŒåŒ…å«æ‰¹å¤„ç†è¯·æ±‚ï¼Œä½¿ç”¨File APIä¸Šä¼ ",
            "example": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹",
            "example": "/v1/chat/completions"
          },
          "completion_window": {
            "type": "string",
            "description": "å®Œæˆçª—å£ï¼Œæ ¼å¼ï¼šæ•°å­—+å•ä½(m/h/d)ï¼Œé»˜è®¤\"24h\"",
            "example": "24h"
          },
          "metadata": {
            "type": "object",
            "description": "æ‰¹å¤„ç†å…ƒæ•°æ®ï¼Œè‡ªå®šä¹‰é”®å€¼å¯¹",
            "example": {
              "description": "Customer support chat completions batch"
            }
          }
        },
        "required": [
          "input_file_id",
          "endpoint"
        ]
      },
      "CallbackResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "example": 200
          },
          "timestamp": {
            "type": "integer",
            "format": "int64",
            "example": 1762856201269
          },
          "data": {
            "type": "string",
            "description": "ä»»åŠ¡ID",
            "example": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          }
        }
      },
      "BlockingResponse": {
        "type": "object",
        "description": "è¿”å›Workerçš„å¤„ç†ç»“æœ",
        "example": {
          "id": "chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
          "object": "chat.completion",
          "created": 1762857979,
          "model": "deepseek-r1-20250401",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "ä½ å¥½å‘€ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹",
                "tool_calls": [],
                "reasoning_content": "ç”¨æˆ·å‘æ¥ç®€å•çš„é—®å€™"
              },
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 4,
            "total_tokens": 307,
            "completion_tokens": 303
          }
        }
      },
      "TakeTaskResponse": {
        "type": "object",
        "description": "è·å–ä»»åŠ¡å“åº”ï¼Œé”®ä¸ºé˜Ÿåˆ—åç§°(å¦‚test-queue:1)ï¼Œå€¼ä¸ºä»»åŠ¡æ•°ç»„",
        "example": {
          "test-queue:1": [
            {
              "ak": "xxx",
              "endpoint": "/v1/chat/completions",
              "queue": "test-queue",
              "level": 1,
              "data": {
                "model": "deepseek-r1-20250401",
                "messages": [
                  {
                    "role": "user",
                    "content": "ä½ å¥½"
                  }
                ],
                "stream": false
              },
              "status": "waiting",
              "task_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
              "batch_id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
              "trace_id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
              "start_time": 1762863595000,
              "running_time": 0,
              "expire_time": 1762949994000,
              "completed_time": 0,
              "callback_url": "",
              "response_mode": "batch"
            }
          ]
        },
        "additionalProperties": {
          "type": "array",
          "items": {
            "$ref": "#/components/schemas/Task"
          }
        }
      },
      "Task": {
        "type": "object",
        "description": "é˜Ÿåˆ—ä»»åŠ¡å¯¹è±¡ã€‚æ ¹æ®levelå­—æ®µåŒºåˆ†åœ¨çº¿ä»»åŠ¡(level=0)å’Œç¦»çº¿ä»»åŠ¡(level=1)ï¼šåœ¨çº¿ä»»åŠ¡åŒ…å«instance_idå­—æ®µï¼Œç¦»çº¿ä»»åŠ¡åŒ…å«batch_idå’Œtrace_idå­—æ®µ",
        "properties": {
          "ak": {
            "type": "string",
            "description": "è®¿é—®å¯†é’¥",
            "example": "xxx"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹",
            "example": "/v1/chat/completions"
          },
          "queue": {
            "type": "string",
            "description": "é˜Ÿåˆ—åç§°",
            "example": "test-queue"
          },
          "level": {
            "type": "integer",
            "description": "é˜Ÿåˆ—çº§åˆ«ï¼š0(åœ¨çº¿é˜Ÿåˆ—ï¼ŒåŒ…å«instance_id)ã€1(ç¦»çº¿é˜Ÿåˆ—ï¼ŒåŒ…å«batch_idå’Œtrace_id)",
            "enum": [0, 1],
            "example": 1
          },
          "data": {
            "type": "object",
            "description": "ä»»åŠ¡æ•°æ®è½½è·ï¼Œå‚è€ƒOpenAPIä½¿ç”¨æ–‡æ¡£ï¼šhttps://doc.bella.top/docs/bella-openapi/core/chat-completions",
            "example": {
              "model": "deepseek-r1-20250401",
              "messages": [
                {
                  "role": "user",
                  "content": "ä½ å¥½"
                }
              ],
              "stream": false
            }
          },
          "status": {
            "type": "string",
            "description": "ä»»åŠ¡çŠ¶æ€",
            "example": "waiting"
          },
          "task_id": {
            "type": "string",
            "description": "ä»»åŠ¡ID",
            "example": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          },
          "batch_id": {
            "type": "string",
            "description": "æ‰¹é‡ä»»åŠ¡IDï¼ˆä»…ç¦»çº¿ä»»åŠ¡level=1æ—¶å­˜åœ¨ï¼‰",
            "example": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          },
          "trace_id": {
            "type": "string", 
            "description": "è¿½è¸ªIDï¼ˆä»…ç¦»çº¿ä»»åŠ¡level=1æ—¶å­˜åœ¨ï¼‰",
            "example": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          },
          "instance_id": {
            "type": "string",
            "description": "å®ä¾‹IDï¼ˆä»…åœ¨çº¿ä»»åŠ¡level=0æ—¶å­˜åœ¨ï¼‰",
            "example": "xx.xx.xx.xx:xxx"
          },
          "start_time": {
            "type": "integer",
            "format": "int64",
            "description": "ä»»åŠ¡å¼€å§‹æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰",
            "example": 1762863595000
          },
          "running_time": {
            "type": "integer",
            "format": "int64",
            "description": "ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰",
            "example": 0
          },
          "expire_time": {
            "type": "integer",
            "format": "int64",
            "description": "ä»»åŠ¡è¿‡æœŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰",
            "example": 1762949994000
          },
          "completed_time": {
            "type": "integer",
            "format": "int64",
            "description": "ä»»åŠ¡å®Œæˆæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰",
            "example": 0
          },
          "callback_url": {
            "type": "string",
            "description": "å›è°ƒURLï¼ˆcallbackæ¨¡å¼ä½¿ç”¨ï¼‰",
            "example": ""
          },
          "response_mode": {
            "type": "string",
            "enum": [
              "batch",
              "callback",
              "blocking",
              "streaming"
            ],
            "description": "å“åº”æ¨¡å¼",
            "example": "batch"
          }
        }
      },
      "QueueStatsResponse": {
        "type": "object",
        "properties": {
          "waiting": {
            "type": "integer",
            "description": "ç­‰å¾…ä¸­çš„ä»»åŠ¡æ•°"
          },
          "running": {
            "type": "integer",
            "description": "è¿è¡Œä¸­çš„ä»»åŠ¡æ•°"
          },
          "completed": {
            "type": "integer",
            "description": "å·²å®Œæˆçš„ä»»åŠ¡æ•°"
          },
          "failed": {
            "type": "integer",
            "description": "å¤±è´¥çš„ä»»åŠ¡æ•°"
          }
        }
      },
      "EventBusConfigResponse": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "description": "Redisè¿æ¥URL",
            "example": "redis://localhost:6379"
          },
          "topic": {
            "type": "string",
            "description": "äº‹ä»¶ä¸»é¢˜å‰ç¼€",
            "example": "bella:eventbus:"
          }
        }
      },
      "CreateBatchResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "æ‰¹é‡ä»»åŠ¡ID",
            "example": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          },
          "object": {
            "type": "string",
            "example": "batch"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹"
          },
          "input_file_id": {
            "type": "string",
            "description": "è¾“å…¥æ–‡ä»¶ID"
          },
          "completion_window": {
            "type": "string",
            "description": "å®Œæˆæ—¶é—´çª—å£"
          },
          "created_at": {
            "type": "integer",
            "format": "int64",
            "description": "åˆ›å»ºæ—¶é—´"
          },
          "expired_at": {
            "type": "integer",
            "format": "int64",
            "description": "è¿‡æœŸæ—¶é—´"
          },
          "request_counts": {
            "type": "object",
            "properties": {
              "total": {
                "type": "integer",
                "description": "æ€»ä»»åŠ¡æ•°"
              },
              "completed": {
                "type": "integer",
                "description": "å®Œæˆä»»åŠ¡æ•°"
              },
              "failed": {
                "type": "integer",
                "description": "å¤±è´¥ä»»åŠ¡æ•°"
              }
            }
          }
        },
        "example": {
          "id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
          "object": "batch",
          "endpoint": "/v1/chat/completions",
          "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",
          "completion_window": "24h",
          "created_at": 1762921219017,
          "expired_at": 1763007619015,
          "request_counts": {
            "total": 121,
            "completed": 0,
            "failed": 0
          }
        }
      },
      "BatchResponse": {
        "type": "object",
        "example": {
          "id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
          "object": "batch",
          "endpoint": "/v1/chat/completions",
          "status": "expired",
          "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",
          "completion_window": "24h",
          "output_file_id": "",
          "error_file_id": "",
          "created_at": 1762136757000,
          "in_progress_at": 1762136757000,
          "finalizing_at": 1762223427000,
          "completed_at": 946656000000,
          "failed_at": 946656000000,
          "expired_at": 1762223157000,
          "cancelling_at": 946656000000,
          "cancelled_at": 946656000000,
          "request_counts": {
            "total": 121,
            "completed": 8,
            "failed": 0
          }
        },
        "properties": {
          "id": {
            "type": "string",
            "description": "æ‰¹é‡ä»»åŠ¡ID",
            "example": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          },
          "object": {
            "type": "string",
            "example": "batch"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹"
          },
          "status": {
            "type": "string",
            "enum": [
              "validating",
              "failed",
              "in_progress",
              "finalizing",
              "completed",
              "expired",
              "cancelling",
              "cancelled"
            ],
            "description": "æ‰¹é‡ä»»åŠ¡çŠ¶æ€"
          },
          "input_file_id": {
            "type": "string",
            "description": "è¾“å…¥æ–‡ä»¶ID"
          },
          "completion_window": {
            "type": "string",
            "description": "å®Œæˆæ—¶é—´çª—å£"
          },
          "output_file_id": {
            "type": "string",
            "description": "è¾“å‡ºæ–‡ä»¶ID"
          },
          "error_file_id": {
            "type": "string",
            "description": "é”™è¯¯æ–‡ä»¶ID"
          },
          "created_at": {
            "type": "integer",
            "format": "int64",
            "description": "åˆ›å»ºæ—¶é—´"
          },
          "in_progress_at": {
            "type": "integer",
            "format": "int64",
            "description": "å¼€å§‹å¤„ç†æ—¶é—´"
          },
          "finalizing_at": {
            "type": "integer",
            "format": "int64",
            "description": "å®Œç»“å¼€å§‹æ—¶é—´"
          },
          "completed_at": {
            "type": "integer",
            "format": "int64",
            "description": "å®Œæˆæ—¶é—´"
          },
          "failed_at": {
            "type": "integer",
            "format": "int64",
            "description": "å¤±è´¥æ—¶é—´"
          },
          "expired_at": {
            "type": "integer",
            "format": "int64",
            "description": "è¿‡æœŸæ—¶é—´"
          },
          "cancelling_at": {
            "type": "integer",
            "format": "int64",
            "description": "å–æ¶ˆä¸­æ—¶é—´"
          },
          "cancelled_at": {
            "type": "integer",
            "format": "int64",
            "description": "å–æ¶ˆå®Œæˆæ—¶é—´"
          },
          "request_counts": {
            "type": "object",
            "properties": {
              "total": {
                "type": "integer",
                "description": "æ€»ä»»åŠ¡æ•°"
              },
              "completed": {
                "type": "integer",
                "description": "å®Œæˆä»»åŠ¡æ•°"
              },
              "failed": {
                "type": "integer",
                "description": "å¤±è´¥ä»»åŠ¡æ•°"
              }
            }
          }
        }
      },
      "ListBatchesResponse": {
        "type": "object",
        "properties": {
          "object": {
            "type": "string",
            "example": "list"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BatchResponse"
            }
          },
          "has_more": {
            "type": "boolean",
            "description": "æ˜¯å¦æœ‰æ›´å¤šæ•°æ®"
          }
        }
      },
      "DetailedQueueStatsResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ä¸»é”®id"
          },
          "queue": {
            "type": "string",
            "description": "é˜Ÿåˆ—åç§°"
          },
          "level": {
            "type": "integer",
            "description": "é˜Ÿåˆ—level"
          },
          "last_wrote_sharding_key": {
            "type": "string",
            "description": "å†™æŒ‡é’ˆåˆ†ç‰‡é”®"
          },
          "last_wrote_id": {
            "type": "integer",
            "description": "å†™æŒ‡é’ˆåˆ†ç‰‡é”®ä¸»é”®ID"
          },
          "last_scanned_sharding_key": {
            "type": "string",
            "description": "æ‰«ææŒ‡é’ˆåˆ†ç‰‡é”®"
          },
          "last_scanned_id": {
            "type": "integer",
            "description": "æ‰«ææŒ‡é’ˆåˆ†ç‰‡é”®ä¸»é”®ID"
          },
          "total_put_cnt": {
            "type": "integer",
            "description": "æ€»å…¥é˜Ÿä»»åŠ¡æ•°"
          },
          "total_loaded_cnt": {
            "type": "integer",
            "description": "æ€»æ‰«æä»»åŠ¡æ•°"
          },
          "total_completed_cnt": {
            "type": "integer",
            "description": "æ€»å®Œæˆä»»åŠ¡æ•°"
          },
          "cuid": {
            "type": "integer",
            "description": "åˆ›å»ºäººID"
          },
          "muid": {
            "type": "integer",
            "description": "ä¿®æ”¹äººID"
          },
          "cu_name": {
            "type": "string",
            "description": "åˆ›å»ºäººåç§°"
          },
          "mu_name": {
            "type": "string",
            "description": "ä¿®æ”¹äººåç§°"
          },
          "ctime": {
            "type": "string",
            "format": "date-time",
            "description": "åˆ›å»ºæ—¶é—´"
          },
          "mtime": {
            "type": "string",
            "format": "date-time",
            "description": "ä¿®æ”¹æ—¶é—´"
          }
        },
        "example": {
          "id": 2,
          "queue": "test-queue",
          "level": 1,
          "last_wrote_sharding_key": "2-1-20251031183551",
          "last_wrote_id": 124,
          "last_scanned_sharding_key": "2-1-20251031183551",
          "last_scanned_id": 124,
          "total_put_cnt": 124,
          "total_loaded_cnt": 124,
          "total_completed_cnt": 7,
          "cuid": 10001,
          "muid": 10001,
          "cu_name": "xxx",
          "mu_name": "xxx",
          "ctime": "2025-10-31T18:35:52",
          "mtime": "2025-11-11T12:12:14"
        }
      },
      "StreamingResponse": {
        "type": "string",
        "description": "Server-Sent Eventsæµå¼å“åº”æ•°æ®",
        "example": "data: {\"id\":\"chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\"object\":\"chat.completion.chunk\",\"created\":1762858384,\"model\":\"deepseek-r1-20250401\",\"choices\":[{\"index\":0,\"delta\":{\"role\":\"assistant\",\"content\":\"\"},\"logprobs\":null,\"finish_reason\":null}]}\n\ndata: {\"id\":\"chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\"object\":\"chat.completion.chunk\",\"created\":1762858384,\"model\":\"deepseek-r1-20250401\",\"choices\":[{\"index\":0,\"delta\":{\"content\":\"ä½ å¥½\"},\"logprobs\":null,\"finish_reason\":null}]}\n\ndata: [DONE]"
      },
      "CancelBatchResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "æ‰¹é‡ä»»åŠ¡ID",
            "example": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"
          },
          "object": {
            "type": "string",
            "example": "batch"
          },
          "endpoint": {
            "type": "string",
            "description": "å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ç‚¹",
            "example": "/v1/chat/completions"
          },
          "input_file_id": {
            "type": "string",
            "description": "è¾“å…¥æ–‡ä»¶ID",
            "example": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX"
          },
          "completion_window": {
            "type": "string",
            "description": "å®Œæˆæ—¶é—´çª—å£",
            "example": "24h"
          },
          "created_at": {
            "type": "integer",
            "format": "int64",
            "description": "åˆ›å»ºæ—¶é—´",
            "example": 1762928558649
          },
          "expired_at": {
            "type": "integer",
            "format": "int64",
            "description": "è¿‡æœŸæ—¶é—´",
            "example": 1763014958648
          },
          "request_counts": {
            "type": "object",
            "properties": {
              "total": {
                "type": "integer",
                "description": "æ€»ä»»åŠ¡æ•°"
              },
              "completed": {
                "type": "integer",
                "description": "å®Œæˆä»»åŠ¡æ•°"
              },
              "failed": {
                "type": "integer",
                "description": "å¤±è´¥ä»»åŠ¡æ•°"
              }
            }
          }
        },
        "example": {
          "id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",
          "object": "batch",
          "endpoint": "/v1/chat/completions",
          "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",
          "completion_window": "24h",
          "created_at": 1762928558649,
          "expired_at": 1763014958648,
          "request_counts": {
            "total": 121,
            "completed": 0,
            "failed": 0
          }
        }
      }
    }
  }
}
