<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-bella-openapi/core/realtime" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Bella OpenAPI 实时语音对话接口文档 | Bella Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://doc.bella.top/img/bella-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://doc.bella.top/img/bella-social-card.jpg"><meta data-rh="true" property="og:url" content="https://doc.bella.top/docs/bella-openapi/core/realtime"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Bella OpenAPI 实时语音对话接口文档 | Bella Documentation"><meta data-rh="true" name="description" content="目录"><meta data-rh="true" property="og:description" content="目录"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://doc.bella.top/docs/bella-openapi/core/realtime"><link data-rh="true" rel="alternate" href="https://doc.bella.top/docs/bella-openapi/core/realtime" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://doc.bella.top/en/docs/bella-openapi/core/realtime" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doc.bella.top/docs/bella-openapi/core/realtime" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3e6de87c.css">
<script src="/assets/js/runtime~main.4a486d21.js" defer="defer"></script>
<script src="/assets/js/main.629bb5ff.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Bella Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Bella Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Bella</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">文档</a><a class="navbar__item navbar__link" href="/api-viewer">API</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><div id="github-star-button"></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文 (简体)</a><ul class="dropdown__menu"><li><a href="/docs/bella-openapi/core/realtime" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中文 (简体)</a></li><li><a href="/en/docs/bella-openapi/core/realtime" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li></ul></div><a href="https://github.com/LianjiaTech/bella-openapi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">介绍（Introduction）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/bella-openapi/intro">OpenAPI</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/intro">介绍（Introduction）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/bella-openapi/configuration-details">配置与部署 (Configuration &amp; Deployment)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/bella-openapi/core/chat-completions">核心功能 (Core Features)</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/core/chat-completions">智能问答接口文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/core/embeddings">文本向量接口文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/core/flash-asr">一句话语音识别接口文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/core/tts">语音合成接口文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/bella-openapi/core/realtime">Bella OpenAPI 实时语音对话接口文档</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/bella-openapi/tech/system-structure">技术文档（Tech Documents）</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OpenAPI</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">核心功能 (Core Features)</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Bella OpenAPI 实时语音对话接口文档</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Bella OpenAPI 实时语音对话接口文档</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="目录">目录<a href="#目录" class="hash-link" aria-label="目录的直接链接" title="目录的直接链接">​</a></h2>
<ul>
<li><a href="#1-%E6%A6%82%E8%BF%B0">1. 概述</a>
<ul>
<li><a href="#11-%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7">1.1 功能特性</a></li>
<li><a href="#12-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">1.2 应用场景</a></li>
</ul>
</li>
<li><a href="#2-%E6%8E%A5%E5%8F%A3%E8%A7%84%E6%A0%BC">2. 接口规格</a>
<ul>
<li><a href="#21-%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF">2.1 基本信息</a></li>
<li><a href="#22-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0">2.2 请求参数</a>
<ul>
<li><a href="#221-url-%E5%8F%82%E6%95%B0">2.2.1 URL 参数</a></li>
<li><a href="#222-websocket-%E5%90%AF%E5%8A%A8%E6%B6%88%E6%81%AF">2.2.2 WebSocket 启动消息</a></li>
<li><a href="#223-%E9%9F%B3%E9%A2%91%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">2.2.3 音频数据格式</a></li>
</ul>
</li>
<li><a href="#23-%E5%93%8D%E5%BA%94%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B">2.3 响应消息类型</a>
<ul>
<li><a href="#231-%E8%BD%AC%E5%86%99%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF">2.3.1 转写相关消息</a></li>
<li><a href="#232-llm-%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF">2.3.2 LLM 相关消息</a></li>
<li><a href="#233-%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF">2.3.3 语音合成相关消息</a></li>
<li><a href="#234-vad-%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF">2.3.4 VAD 相关消息</a></li>
<li><a href="#235-%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6%E5%92%8C%E9%94%99%E8%AF%AF%E6%B6%88%E6%81%AF">2.3.5 会话控制和错误消息</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#3-%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97">3. 接入指南</a>
<ul>
<li><a href="#31-java-%E6%8E%A5%E5%85%A5%E7%A4%BA%E4%BE%8B">3.1 Java 接入示例</a></li>
<li><a href="#32-javascript-%E6%8E%A5%E5%85%A5%E7%A4%BA%E4%BE%8B">3.2 JavaScript 接入示例</a></li>
<li><a href="#33-%E5%8F%AF%E7%94%A8%E7%9A%84%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90%E9%9F%B3%E8%89%B2">3.3 可用的语音合成音色</a></li>
</ul>
</li>
<li><a href="#4-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">4. 错误处理</a></li>
<li><a href="#5-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">5. 最佳实践</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-概述">1. 概述<a href="#1-概述" class="hash-link" aria-label="1. 概述的直接链接" title="1. 概述的直接链接">​</a></h2>
<p>实时语音对话接口提供了一站式的语音识别、大模型对话和语音合成能力，支持用户通过麦克风进行实时语音输入，系统自动识别语音内容，调用大模型生成回复，并将回复内容转换为语音输出。整个过程通过 WebSocket 协议实现，具有低延迟、高实时性的特点。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-功能特点">1.1 功能特点<a href="#11-功能特点" class="hash-link" aria-label="1.1 功能特点的直接链接" title="1.1 功能特点的直接链接">​</a></h3>
<ul>
<li><strong>实时语音识别</strong>：支持用户实时语音输入，并将语音转换为文本</li>
<li><strong>流式大模型对话</strong>：将识别的文本发送给大模型，获取流式回复</li>
<li><strong>语音合成</strong>：将大模型回复转换为语音，实现自然的语音对话体验</li>
<li><strong>全双工通信</strong>：基于 WebSocket 协议，支持全双工通信，实现真正的实时对话</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-应用场景">1.2 应用场景<a href="#12-应用场景" class="hash-link" aria-label="1.2 应用场景的直接链接" title="1.2 应用场景的直接链接">​</a></h3>
<ul>
<li>智能语音助手</li>
<li>客服机器人</li>
<li>语音交互系统</li>
<li>无障碍应用</li>
<li>车载语音系统</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-接口规格">2. 接口规格<a href="#2-接口规格" class="hash-link" aria-label="2. 接口规格的直接链接" title="2. 接口规格的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-基本信息">2.1 基本信息<a href="#21-基本信息" class="hash-link" aria-label="2.1 基本信息的直接链接" title="2.1 基本信息的直接链接">​</a></h3>
<ul>
<li><strong>接口路径</strong>：<code>/v1/audio/realtime</code> 或 <code>/v1/audio/asr/stream</code>（只返回转录事件）</li>
<li><strong>协议</strong>：WebSocket</li>
<li><strong>请求方式</strong>：GET</li>
<li><strong>认证方式</strong>：Bearer Token（通过请求头 <code>Authorization</code> 传递）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-请求参数">2.2 请求参数<a href="#22-请求参数" class="hash-link" aria-label="2.2 请求参数的直接链接" title="2.2 请求参数的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-url-参数">2.2.1 URL 参数<a href="#221-url-参数" class="hash-link" aria-label="2.2.1 URL 参数的直接链接" title="2.2.1 URL 参数的直接链接">​</a></h4>
<table><thead><tr><th>参数名</th><th>类型</th><th>必选</th><th>描述</th></tr></thead><tbody><tr><td>model</td><td>string</td><td>否</td><td>指定使用的模型，不指定则使用能力点的默认模型</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-websocket-启动消息">2.2.2 WebSocket 启动消息<a href="#222-websocket-启动消息" class="hash-link" aria-label="2.2.2 WebSocket 启动消息的直接链接" title="2.2.2 WebSocket 启动消息的直接链接">​</a></h4>
<p>连接建立后，客户端需要发送一个 JSON 格式的启动消息：
<code>/v1/audio/realtime</code>，启动消息如下：
<code>/v1/audio/asr/stream</code> 不需要 <code>llm_option</code> 和 <code>tts_option</code> 参数</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="starttranscription-消息">StartTranscription 消息<a href="#starttranscription-消息" class="hash-link" aria-label="StartTranscription 消息的直接链接" title="StartTranscription 消息的直接链接">​</a></h5>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;header&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;task_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SpeechTranscriber&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;StartTranscription&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;appkey&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;format&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;pcm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;sample_rate&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;enable_intermediate_result&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;enable_punctuation_prediction&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;enable_inverse_text_normalization&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;llm_option&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;main&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;model&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;qwen2.5-coder:3b&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;sys_prompt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;你是一个全能的语音助理，你的回复会转成音频给用户，所以请尽可能简洁的回复，同时首句话尽快结束以便更好的进行流式合成语音&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;tts_option&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;model&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;chat-tts&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;sample_rate&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">24000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>参数说明：</p>
<ul>
<li>
<p><strong>header</strong>: 消息头部信息</p>
<ul>
<li><strong>message_id</strong>: 消息唯一标识，建议使用 UUID</li>
<li><strong>task_id</strong>: 任务唯一标识，建议使用 UUID</li>
<li><strong>namespace</strong>: 固定为 &quot;SpeechTranscriber&quot;</li>
<li><strong>name</strong>: 固定为 &quot;StartTranscription&quot;</li>
<li><strong>appkey</strong>: 固定为 &quot;default&quot;</li>
</ul>
</li>
<li>
<p><strong>payload</strong>: 任务配置参数</p>
<ul>
<li><strong>format</strong>: 音频格式，固定为 &quot;pcm&quot;</li>
<li><strong>sample_rate</strong>: 音频采样率，推荐 16000</li>
<li><strong>enable_intermediate_result</strong>: 是否启用中间结果，建议设为 true</li>
<li><strong>enable_punctuation_prediction</strong>: 是否启用标点预测，建议设为 true</li>
<li><strong>enable_inverse_text_normalization</strong>: 是否启用逆文本规范化，建议设为 true</li>
<li><strong>llm_option</strong>: 大模型选项（可选）<!-- -->
<ul>
<li><strong>main</strong>: 主模型配置<!-- -->
<ul>
<li><strong>model</strong>: 模型名称，如 &quot;qwen2.5-coder:3b&quot;</li>
<li><strong>sys_prompt</strong>: 系统提示词，用于设置模型的行为和角色，可以使用 Python Jinja2 模板</li>
<li><strong>prompt</strong>: 用户提示词，可以提供 Python Jinja2 模板，通过上下文改写用户消息传给大模型</li>
<li><strong>temperature</strong>: 温度参数，控制输出的随机性，值越大随机性越高，取值范围 [0.0, 2.0]，默认为 1.0</li>
</ul>
</li>
<li><strong>workers</strong>: 工作者模型配置列表（可选），每个工作者模型包含以下属性<!-- -->
<ul>
<li><strong>model</strong>: 模型名称</li>
<li><strong>blocking</strong>: 是否阻塞，默认为 false</li>
<li><strong>variable_name</strong>: 结果变量名</li>
<li><strong>variable_type</strong>: 变量类型</li>
<li><strong>sys_prompt</strong>: 系统提示词，可以使用 Python Jinja2 模板</li>
<li><strong>prompt</strong>: 用户提示词，可以使用 Python Jinja2 模板</li>
<li><strong>temperature</strong>: 温度参数，默认为 1.0</li>
<li><strong>json_schema</strong>: JSON 模式定义</li>
</ul>
</li>
</ul>
</li>
<li><strong>tts_option</strong>: 语音合成选项（可选）<!-- -->
<ul>
<li><strong>model</strong>: 语音合成模型，如 &quot;chat-tts&quot;</li>
<li><strong>sample_rate</strong>: 合成音频采样率，推荐 24000</li>
<li><strong>voice</strong>: 合成音色（可选），具体可用音色取决于所选模型</li>
</ul>
</li>
<li><strong>variables</strong>: 变量配置（可选）map，结合prompt模版使用</li>
</ul>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例">配置示例<a href="#配置示例" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h5>
<p>以下是一个包含主模型和工作者模型的完整配置示例，展示了如何使用 Jinja2 模板和变量进行消息改写：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;llm_option&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;main&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;model&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;qwen2.5-coder:3b&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;sys_prompt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;你是一个全能的语音助理，你的回复会转成音频给用户，所以请尽可能简洁的回复，同时首句话尽快结束以便更好的进行流式合成语音。&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;workers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;model&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;qwen2.5-coder:3b&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;blocking&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;variable_name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rewrite_user_message&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;sys_prompt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;你是一个user message rewrite专家，负责将基于voice转录的用户消息进行改写，让其更通顺和连贯，同时完成必须的指代消歧。不要解释，直接改写，如果不需要改写，则直接输出用户的原始内容&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;prompt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;## 用户历史对话\n&lt;history_messages&gt;\n{% for message in history_messages %}\n{% if message.role == \&quot;user\&quot; %}\n  &lt;user timestamp=\&quot;{{loop.index}}\&quot;&gt;{{{ message.content }}}&lt;/user&gt;\n{% elif message.role == \&quot;assistant\&quot; %}\n  &lt;agent timestamp=\&quot;{{loop.index}}\&quot;&gt;{{{ message.content }}}&lt;/agent&gt;\n{% endif %}\n{% endfor %}\n\n&lt;/history_messages&gt;\n\n## 用户最新消息\n&lt;user_message&gt;\n  {{user_message}}\n&lt;/user_message&gt;\n\n请进行消息改写吧！\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;tts_option&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;model&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;chat-tts&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;voice&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;zh_female&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;sample_rate&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">24000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该配置示例展示了：</p>
<ol>
<li>主模型配置：使用 qwen2.5-coder:3b 模型与用户进行对话</li>
<li>工作者模型配置：使用相同模型作为工作者，负责改写用户消息</li>
<li>工作者模型使用 Jinja2 模板处理历史消息和当前用户消息</li>
<li>TTS 配置：指定了模型、音色和采样率</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="stoptranscription-消息">StopTranscription 消息<a href="#stoptranscription-消息" class="hash-link" aria-label="StopTranscription 消息的直接链接" title="StopTranscription 消息的直接链接">​</a></h5>
<p>当需要结束转写任务时，客户端需要发送一个 StopTranscription 消息：
服务端处理完未完成的消息后，会返回SessionClose消息。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;header&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;task_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SpeechTranscriber&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;StopTranscription&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;appkey&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="223-音频数据">2.2.3 音频数据<a href="#223-音频数据" class="hash-link" aria-label="2.2.3 音频数据的直接链接" title="2.2.3 音频数据的直接链接">​</a></h4>
<p>启动消息发送后，客户端需要持续发送二进制格式的音频数据。音频数据要求：</p>
<ul>
<li>格式：PCM（脉冲编码调制）</li>
<li>采样率：16000Hz</li>
<li>位深度：16位</li>
<li>通道数：单通道（mono）</li>
<li>每帧大小：推荐 3200 字节（对应 100ms 的音频）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-响应消息">2.3 响应消息<a href="#23-响应消息" class="hash-link" aria-label="2.3 响应消息的直接链接" title="2.3 响应消息的直接链接">​</a></h3>
<p>服务器会通过 WebSocket 连接发送多种类型的文本消息和二进制数据。文本消息为 JSON 格式，主要包含以下类型：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="231-转写相关消息">2.3.1 转写相关消息<a href="#231-转写相关消息" class="hash-link" aria-label="2.3.1 转写相关消息的直接链接" title="2.3.1 转写相关消息的直接链接">​</a></h4>
<ul>
<li><strong>TranscriptionStarted</strong>: 转写任务开始</li>
<li><strong>SentenceBegin</strong>: 检测到语音开始</li>
<li><strong>TranscriptionResultChanged</strong>: 转写结果更新</li>
<li><strong>SentenceEnd</strong>: 语音句子结束，包含最终转写结果</li>
<li><strong>TranscriptionCompleted</strong>: 转写任务完成</li>
<li><strong>TranscriptionFailed</strong>: 转写任务失败</li>
</ul>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;header&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;task_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SpeechTranscriber&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TranscriptionResultChanged&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;result&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;你好，我想了解一下今天的天气怎么样&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="232-大模型相关消息">2.3.2 大模型相关消息<a href="#232-大模型相关消息" class="hash-link" aria-label="2.3.2 大模型相关消息的直接链接" title="2.3.2 大模型相关消息的  直接链接">​</a></h4>
<ul>
<li><strong>LLM_CHAT_BEGIN</strong>: 大模型开始生成回复</li>
<li><strong>LLM_CHAT_DELTA</strong>: 大模型回复内容更新</li>
<li><strong>LLM_CHAT_END</strong>: 大模型回复结束</li>
<li><strong>LLM_CHAT_CANCELLED</strong>: 大模型回复被取消</li>
</ul>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;header&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;task_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SpeechTranscriber&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LLM_CHAT_DELTA&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;data&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;你好！今天北京天气晴朗，气温22°C到28°C，空气质量良好，是个适合户外活动的好天气。&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="233-语音合成相关消息">2.3.3 语音合成相关消息<a href="#233-语音合成相关消息" class="hash-link" aria-label="2.3.3 语音合成相关消息的直接链接" title="2.3.3 语音合成相关消息的直接链接">​</a></h4>
<ul>
<li><strong>TTS_BEGIN</strong>: 语音合成开始</li>
<li><strong>TTS_TTFT</strong>: 首个音频数据包就绪（Time To First Token）</li>
<li><strong>TTS_DELTA</strong>: 语音合成增量数据</li>
<li><strong>TTS_END</strong>: 语音合成结束</li>
</ul>
<p>语音合成的音频数据通过二进制消息发送，格式为 PCM，采样率为 24000Hz，16位，单通道。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="234-vad-相关消息语音活动检测">2.3.4 VAD 相关消息（语音活动检测）<a href="#234-vad-相关消息语音活动检测" class="hash-link" aria-label="2.3.4 VAD 相关消息（语音活动检测）的直接链接" title="2.3.4 VAD 相关消息（语音活动检测）的直接链接">​</a></h4>
<ul>
<li><strong>VOICE_QUIET</strong>: 检测到静音</li>
<li><strong>VOICE_STARTING</strong>: 检测到开始说话</li>
<li><strong>VOICE_SPEAKING</strong>: 检测到正在说话</li>
<li><strong>VOICE_STOPPING</strong>: 检测到停止说话</li>
<li><strong>VOICE_PAUSING</strong>: 检测到说话暂停</li>
</ul>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;header&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;task_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SpeechTranscriber&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;VOICE_SPEAKING&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;status_message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GATEWAY|SUCCESS|Success.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;start_frame&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;end_frame&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">29</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;duration&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">576</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;data&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token null keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1744612674.163157</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;latency&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">-1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="235-会话控制和错误消息">2.3.5 会话控制和错误消息<a href="#235-会话控制和错误消息" class="hash-link" aria-label="2.3.5 会话控制和错误消息的直接链接" title="2.3.5 会话控制和错误消息的直接链接">​</a></h4>
<ul>
<li><strong>SESSION_CLOSE</strong>: 会话关闭，客户端发送StopTranscription消息后，服务端处理完未完成的消息后，会返回SessionClose消息。</li>
<li><strong>TASK_FAILED</strong>: 任务失败</li>
<li><strong>LLM_CHAT_ERROR</strong>: LLM 聊天错误</li>
<li><strong>LLM_WORKER_ERROR</strong>: LLM 子任务错误</li>
</ul>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;header&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;task_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uuid-string&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SpeechTranscriber&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SESSION_CLOSE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-接入指南">3. 接入指南<a href="#3-接入指南" class="hash-link" aria-label="3. 接入指南的直接链接" title="3. 接入指南的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-java-接入示例">3.1 Java 接入示例<a href="#31-java-接入示例" class="hash-link" aria-label="3.1 Java 接入示例的直接链接" title="3.1 Java 接入示例的直接链接">​</a></h3>
<p>实时语音接口的 Java 实现可以参考项目中的 <a href="https://github.com/LianjiaTech/bella-openapi/blob/develop/api/server/src/test/java/com/ke/bella/openapi/RealtimeDemo.java" target="_blank" rel="noopener noreferrer">RealtimeDemo.java</a> 类。</p>
<p>该示例展示了如何使用 OkHttp 库实现 WebSocket 连接，并完成以下功能  ：</p>
<ol>
<li>建立 WebSocket 连接并发送 StartTranscription 消息</li>
<li>发送音频数据（PCM 格式）</li>
<li>处理各种事件类型（转写、VAD、LLM、TTS 等）</li>
<li>接收和处理 TTS 音频数据</li>
<li>发送 StopTranscription 消息结束会话</li>
</ol>
<p>示例中包含了完整的错误处理和资源释放逻辑，可以作为实现的参考。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-javascript-接入示例">3.2 JavaScript 接入示例<a href="#32-javascript-接入示例" class="hash-link" aria-label="3.2 JavaScript 接入示例的直接链接" title="3.2 JavaScript 接入示例的直接链接">​</a></h3>
<p>实时语音接口的 JavaScript 实现可以参考项目中的 <a href="https://github.com/LianjiaTech/bella-openapi/blob/develop/web/src/components/playground/RealtimeAudioRecorder.ts" target="_blank" rel="noopener noreferrer">RealtimeAudioRecorder.ts</a> 类。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-可用的语音合成音色">3.3 可用的语音合成音色<a href="#33-可用的语音合成音色" class="hash-link" aria-label="3.3 可用的语音合成音色的直接链接" title="3.3 可用的语音合成音色的直接链接">​</a></h3>
<p>不同模型可用的音色不同，详情请访问bella-openapi主页获取。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-错误处理">4. 错误处理<a href="#4-错误处理" class="hash-link" aria-label="4. 错误处理的直接链接" title="4. 错误处理的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-常见错误码">4.1 常见错误码<a href="#41-常见错误码" class="hash-link" aria-label="4.1 常见错误码的直接链接" title="4.1 常见错误码的直接链接">​</a></h3>
<table><thead><tr><th>错误码</th><th>描述</th><th>解决方案</th></tr></thead><tbody><tr><td>401</td><td>未授权</td><td>检查API Key是否正确</td></tr><tr><td>403</td><td>禁止访问</td><td>检查API Key权限</td></tr><tr><td>429</td><td>请求过多</td><td>降低请求频率</td></tr><tr><td>500</td><td>服务器内部错误</td><td>联系技术支持</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-websocket-连接错误">4.2 WebSocket 连接错误<a href="#42-websocket-连接错误" class="hash-link" aria-label="4.2 WebSocket 连接错误的直接链接" title="4.2 WebSocket 连接错误的直接链接">​</a></h3>
<table><thead><tr><th>错误类型</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>连接失败</td><td>网络问题或服务不可用</td><td>检查网络连接，稍后重试</td></tr><tr><td>连接关闭</td><td>服务器关闭连接或网络中断</td><td>实现自动重连机制</td></tr><tr><td>消息解析错误</td><td>无效的JSON格式</td><td>检查消息格式</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-最佳实践">5. 最佳实践<a href="#5-最佳实践" class="hash-link" aria-label="5. 最佳实践的直接链接" title="5. 最佳实践的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-音频质量优化">5.1 音频质量优化<a href="#51-音频质量优化" class="hash-link" aria-label="5.1 音频质量优化的直接链接" title="5.1 音频质量优化的直接链接">​</a></h3>
<ul>
<li>使用高质量麦克风，减少环境噪音</li>
<li>保持适当的音量和距离</li>
<li>使用降噪和回声消除技术</li>
<li>确保音频采样率和格式符合要求</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-性能优化">5.2 性能优化<a href="#52-性能优化" class="hash-link" aria-label="5.2 性能优化的直接链接" title="5.2 性能优化的直接链接">​</a></h3>
<ul>
<li>实现断线重连机制</li>
<li>优化音频数据处理和发送逻辑</li>
<li>使用 WebWorker 处理音频数据，避免阻塞主线程</li>
<li>实现缓冲机制，平滑处理网络波动</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-用户体  验优化">5.3 用户体验优化<a href="#53-用户体验优化" class="hash-link" aria-label="5.3 用户体验优化的直接链接" title="5.3 用户体验优化的直接链接">​</a></h3>
<ul>
<li>提供清晰的录音状态指示</li>
<li>显示实时转写结果，提供视觉反馈</li>
<li>实现语音活动检测，自动开始和结束录音</li>
<li>提供音量可视化，帮助用户调整音量</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-示例代码">6. 示例代码<a href="#6-示例代码" class="hash-link" aria-label="6. 示例代码的直接链接" title="6. 示例代码的直接链接">​</a></h2>
<p>完整的前端实现示例可以参考 Bella OpenAPI 项目中的以下文件：</p>
<ul>
<li><code>web/src/app/playground/v1/audio/realtime/page.tsx</code>: 实时语音对话页面</li>
<li><code>web/src/components/playground/RealtimeAudioRecorder.ts</code>: 实时语音录制器</li>
<li><code>web/src/components/playground/PCMPlayer.ts</code>: PCM音频播放器</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-常见问题">7. 常见问题<a href="#7-常见问题" class="hash-link" aria-label="7. 常见问题的直接链接" title="7. 常见问题的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="q1-为什么我的语音识别结果不准确">Q1: 为什么我的语音识别结果不准确？<a href="#q1-为什么我的语音识别结果不准确" class="hash-link" aria-label="Q1: 为什么我的语音识别结果不准确？的直接链接" title="Q1: 为什么我的语音识别结果不准确？的直接链接">​</a></h3>
<p>A1: 可能是由于麦克风质量、环境噪音或网络问题导致。建议使用高质量麦克风，在安静的环境中使用，并确保网络连接稳定。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="q2-如何处理不同浏览器的兼容性问题">Q2: 如何处理不同浏览器的兼容性问题？<a href="#q2-如何处理不同浏览器的兼容性问题" class="hash-link" aria-label="Q2: 如何处理不同浏览器的兼容性问题？的直接链接" title="Q2: 如何处理不同浏览器的兼容性问题？的直接链接">​</a></h3>
<p>A2: 使用 WebRTC adapter 库处理不同浏览器的兼容性问题，并在不支持的浏览器上提供友好的提示。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="q3-如何优化移动设备上的性能">Q3: 如何优化移动设备上的性能？<a href="#q3-如何优化移动设备上的性能" class="hash-link" aria-label="Q3: 如何优化移动设备上的性能？的直接链接" title="Q3: 如何优化移动设备上的性能？的直接链接">​</a></h3>
<p>A3: 减小音频缓冲区大小，优化音频处理逻辑，使用更低的采样率，并实现电池优化策略。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="q4-如何处理网络不稳定的情况">Q4: 如何处理网络不稳定的情况？<a href="#q4-如何处理网络不稳定的情况" class="hash-link" aria-label="Q4: 如何处理网络不稳定的情况？的直接链接" title="Q4: 如何处理网络不稳定的情况？的直接链接">​</a></h3>
<p>A4: 实现断线重连机制，使用音频缓冲策略，并在网络恢复后重新同步对话状态。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="q5-系统支持哪些语言">Q5: 系统支持哪些语言？<a href="#q5-系统支持哪些语言" class="hash-link" aria-label="Q5: 系统支持哪些语言？的直接链接" title="Q5: 系统支持哪些语言？的直接链接">​</a></h3>
<p>A5: 支持的语言取决于所选模型。请参考模型文档了解具体支持的语言列表。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/bella-openapi/core/tts"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">语音合成接口文档</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/bella-openapi/tech/system-structure"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">亿级调用背后：Bella OpenAPI 的企业级稳定性保障</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目录" class="table-of-contents__link toc-highlight">目录</a></li><li><a href="#1-概述" class="table-of-contents__link toc-highlight">1. 概述</a><ul><li><a href="#11-功能特点" class="table-of-contents__link toc-highlight">1.1 功能特点</a></li><li><a href="#12-应用场景" class="table-of-contents__link toc-highlight">1.2 应用场景</a></li></ul></li><li><a href="#2-接口规格" class="table-of-contents__link toc-highlight">2. 接口规格</a><ul><li><a href="#21-基本信息" class="table-of-contents__link toc-highlight">2.1 基本信息</a></li><li><a href="#22-请求参数" class="table-of-contents__link toc-highlight">2.2 请求参数</a></li><li><a href="#23-响应消息" class="table-of-contents__link toc-highlight">2.3 响应消息</a></li></ul></li><li><a href="#3-接入指南" class="table-of-contents__link toc-highlight">3. 接入指南</a><ul><li><a href="#31-java-接入示例" class="table-of-contents__link toc-highlight">3.1 Java 接入示例</a></li><li><a href="#32-javascript-接入示例" class="table-of-contents__link toc-highlight">3.2 JavaScript 接入示例</a></li><li><a href="#33-可用的语音合成音色" class="table-of-contents__link toc-highlight">3.3 可用的语音合成音色</a></li></ul></li><li><a href="#4-错误处理" class="table-of-contents__link toc-highlight">4. 错误处理</a><ul><li><a href="#41-常见错误码" class="table-of-contents__link toc-highlight">4.1 常见错误码</a></li><li><a href="#42-websocket-连接错误" class="table-of-contents__link toc-highlight">4.2 WebSocket 连接错误</a></li></ul></li><li><a href="#5-最佳实践" class="table-of-contents__link toc-highlight">5. 最佳实践</a><ul><li><a href="#51-音频质量优化" class="table-of-contents__link toc-highlight">5.1 音频质量优化</a></li><li><a href="#52-性能优化" class="table-of-contents__link toc-highlight">5.2 性能优化</a></li><li><a href="#53-用户体验优化" class="table-of-contents__link toc-highlight">5.3 用户体验优化</a></li></ul></li><li><a href="#6-示例代码" class="table-of-contents__link toc-highlight">6. 示例代码</a></li><li><a href="#7-常见问题" class="table-of-contents__link toc-highlight">7. 常见问题</a><ul><li><a href="#q1-为什么我的语音识别结果不准确" class="table-of-contents__link toc-highlight">Q1: 为什么我的语音识别结果不准确？</a></li><li><a href="#q2-如何处理不同浏览器的兼容性问题" class="table-of-contents__link toc-highlight">Q2: 如何处理不同浏览器的兼容性问题？</a></li><li><a href="#q3-如何优化移动设备上的性能" class="table-of-contents__link toc-highlight">Q3: 如何优化移动设备上的性能？</a></li><li><a href="#q4-如何处理网络不稳定的情况" class="table-of-contents__link toc-highlight">Q4: 如何处理网络不稳定的情况？</a></li><li><a href="#q5-系统支持哪些语言" class="table-of-contents__link toc-highlight">Q5: 系统支持哪些语言？</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">入门指南</a></li><li class="footer__item"><a class="footer__link-item" href="/api-viewer">API 文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/LianjiaTech/bella-openapi/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/LianjiaTech/bella-openapi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权所有  2025 LianjiaTech. 基于 Docusaurus 构建。</div></div></div></footer></div>
</body>
</html>