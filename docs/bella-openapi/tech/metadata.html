<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-bella-openapi/tech/metadata" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">四层元数据：解密 Bella OpenAPI 的可扩展架构设计 | Bella Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://doc.bella.top/img/bella-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://doc.bella.top/img/bella-social-card.jpg"><meta data-rh="true" property="og:url" content="https://doc.bella.top/docs/bella-openapi/tech/metadata"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="四层元数据：解密 Bella OpenAPI 的可扩展架构设计 | Bella Documentation"><meta data-rh="true" name="description" content="引言：架构设计的挑战"><meta data-rh="true" property="og:description" content="引言：架构设计的挑战"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://doc.bella.top/docs/bella-openapi/tech/metadata"><link data-rh="true" rel="alternate" href="https://doc.bella.top/docs/bella-openapi/tech/metadata" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://doc.bella.top/en/docs/bella-openapi/tech/metadata" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doc.bella.top/docs/bella-openapi/tech/metadata" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"四层元数据：解密 Bella OpenAPI 的可扩展架构设计","item":"https://doc.bella.top/docs/bella-openapi/tech/metadata"}]}</script><link rel="stylesheet" href="/assets/css/styles.c464aa75.css">
<script src="/assets/js/runtime~main.ba11c805.js" defer="defer"></script>
<script src="/assets/js/main.0d5d3851.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Bella Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Bella Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Bella Opensource</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">文档</a><a class="navbar__item navbar__link" href="/api-viewer">API</a><a href="https://wiki.bella.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">DeepWiki<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><div id="github-star-button"></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文 (简体)</a><ul class="dropdown__menu"><li><a href="/docs/bella-openapi/tech/metadata" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中文 (简体)</a></li><li><a href="/en/docs/bella-openapi/tech/metadata" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li></ul></div><a href="https://github.com/LianjiaTech/bella-openapi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro"><span title="介绍（Introduction）" class="linkLabel_WmDU">介绍（Introduction）</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/bella-openapi/intro"><span title="OpenAPI" class="categoryLinkLabel_W154">OpenAPI</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/intro"><span title="介绍（Introduction）" class="linkLabel_WmDU">介绍（Introduction）</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/bella-openapi/configuration-details"><span title="配置与部署 (Configuration &amp; Deployment)" class="categoryLinkLabel_W154">配置与部署 (Configuration &amp; Deployment)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/bella-openapi/core/chat-completions"><span title="使用文档 (Usage Documents)" class="categoryLinkLabel_W154">使用文档 (Usage Documents)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/bella-openapi/features/claude-cache"><span title="特性介绍（Features Introduce）" class="categoryLinkLabel_W154">特性介绍（Features Introduce）</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/bella-openapi/tech/system-structure"><span title="技术文档（Tech Documents）" class="categoryLinkLabel_W154">技术文档（Tech Documents）</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/tech/system-structure"><span title="亿级调用背后：Bella OpenAPI 的企业级稳定性保障" class="linkLabel_WmDU">亿级调用背后：Bella OpenAPI 的企业级稳定性保障</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/bella-openapi/tech/metadata"><span title="四层元数据：解密 Bella OpenAPI 的可扩展架构设计" class="linkLabel_WmDU">四层元数据：解密 Bella OpenAPI 的可扩展架构设计</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/tech/dynamic-route"><span title="动态路由与灵活调度：Bella OpenAPI 的流量分发机制" class="linkLabel_WmDU">动态路由与灵活调度：Bella OpenAPI 的流量分发机制</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/tech/function-call"><span title="为模型赋能：解析 Bella OpenAPI 的 Function Call 机制" class="linkLabel_WmDU">为模型赋能：解析 Bella OpenAPI 的 Function Call 机制</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/tech/async-performace"><span title="异步与高性能：Bella OpenAPI 的 Disruptor 日志框架解析" class="linkLabel_WmDU">异步与高性能：Bella OpenAPI 的 Disruptor 日志框架解析</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/tech/user-authorization"><span title="身份与权限：Bella OpenAPI 的认证授权体系" class="linkLabel_WmDU">身份与权限：Bella OpenAPI 的认证授权体系</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bella-openapi/tech/usage-manage"><span title="计费与配额：Bella OpenAPI 的资源管理机制" class="linkLabel_WmDU">计费与配额：Bella OpenAPI 的资源管理机制</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/bella-openapi/dev/login-spi"><span title="开发者文档（Dev Documents）" class="categoryLinkLabel_W154">开发者文档（Dev Documents）</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/bella-assistants/intro"><span title="assistant&amp;responses" class="categoryLinkLabel_W154">assistant&amp;responses</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/bella-rag/intro"><span title="RAG" class="categoryLinkLabel_W154">RAG</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/bella-workflow/intro"><span title="Workflow" class="categoryLinkLabel_W154">Workflow</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/bella-domify/intro"><span title="Domify" class="categoryLinkLabel_W154">Domify</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/bella-knowledge/intro"><span title="Knowledge" class="categoryLinkLabel_W154">Knowledge</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/claude-code/introduction"><span title="Claude Code With Bella" class="categoryLinkLabel_W154">Claude Code With Bella</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OpenAPI</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">技术文档（Tech Documents）</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">四层元数据：解密 Bella OpenAPI 的可扩展架构设计</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>四层元数据：解密 Bella OpenAPI 的可扩展架构设计</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="引言架构设计的挑战">引言：架构设计的挑战<a href="#引言架构设计的挑战" class="hash-link" aria-label="引言：架构设计的挑战的直接链接" title="引言：架构设计的挑战的直接链接" translate="no">​</a></h2>
<p>当企业需要构建一个支持多种 AI 能力的统一网关时，面临的最大挑战之一是如何设计一个既足够灵活又便于管理的架构。传统的 API 网关通常采用简单的 API 注册模式，难以应对 AI 服务种类繁多、配置复杂且快速迭代的特点。Bella OpenAPI 通过其独特的四层元数据架构优雅地解决了这一问题，本文将深入分析其设计思想与实现细节。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四层元数据架构优雅的分层设计">四层元数据架构：优雅的分层设计<a href="#四层元数据架构优雅的分层设计" class="hash-link" aria-label="四层元数据架构：优雅的分层设计的直接链接" title="四层元数据架构：优雅的分层设计的直接链接" translate="no">​</a></h2>
<p>从 Bella OpenAPI 的源代码中，我们可以清晰地看到其核心采用了 Category-Endpoint-Model-Channel 四层结构。这种分层不是任意设计的，而是基于 AI 服务的本质特性和管理需求精心构建的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一层category类别">第一层：Category（类别）<a href="#第一层category类别" class="hash-link" aria-label="第一层：Category（类别）的直接链接" title="第一层：Category（类别）的直接链接" translate="no">​</a></h3>
<p>Category 是整个元数据体系的顶层结构，用于对不同类型的 AI 能力进行逻辑分组。从代码实现来看：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// CategoryRepo.java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CategoryRepo</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StatusRepo</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">CategoryDB</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token generics"></span><span class="token generics class-name" style="color:rgb(255, 203, 107)">CategoryRecord</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generateCategoryCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> parentCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 层级式编码生成逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 支持树状结构的查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">List</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">CategoryDB</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">queryAllChildrenIncludeSelfByCategoryCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> categoryCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>核心设计特点：</p>
<ul>
<li>树状结构：支持父子关系，可以构建多级类别树</li>
<li>编码机制：自动生成类别编码，确保唯一性和可读性</li>
<li>灵活分组：允许按业务需求或技术特性进行分类</li>
</ul>
<p>这一层解决了&quot;如何组织和管理多种 AI 能力&quot;的问题，使用户可以按照语音服务、文本服务、图像服务等方式直观地浏览和选择所需功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二层endpoint端点">第二层：Endpoint（端点）<a href="#第二层endpoint端点" class="hash-link" aria-label="第二层：Endpoint（端点）的直接链接" title="第二层：Endpoint（端点）的直接链接" translate="no">​</a></h3>
<p>Endpoint 代表具体的 API 功能入口，如聊天补全、实时语音识别等。从代码实现看：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ModelRepo.java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ModelRepo</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StatusRepo</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ModelDB</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ModelRecord</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token generics"></span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 支持模型与端点的关联</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 模型可见性控制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Transactional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">updateVisibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> modelName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 支持模型特性的精确查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SelectSeekStep1</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Record</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Long</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">constructSql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Condition</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">ModelCondition</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 基于 JSON 属性的复杂查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">CollectionUtils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">isNotEmpty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">op</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getFeatures</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> feature </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getFeatures</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> featuresCondition </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> featuresCondition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">and</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">MODEL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">FEATURES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">like</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%\&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> feature </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;\&quot;:true%&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>核心设计特点：</p>
<ul>
<li>多维属性：通过 JSON 字段存储复杂的模型属性和特性</li>
<li>可见性控制：支持公开、私有等多种可见性级别</li>
<li>与端点关联：通过 ModelEndpointRel 表实现与 Endpoint 的多对多关联</li>
<li>授权机制：通过 ModelAuthorizerRel 表实现基于用户或组织的精细授权</li>
</ul>
<p>这一层解决了&quot;如何灵活配置不同 AI 模型及其能力特性&quot;的问题，使系统能够支持多种模型并进行精细的权限控制。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第四层channel通道">第四层：Channel（通道）<a href="#第四层channel通道" class="hash-link" aria-label="第四层：Channel（通道）的直接链接" title="第四层：Channel（通道）的直接链接" translate="no">​</a></h3>
<p>Channel 是具体的服务提供方实现，关联能力点/模型，包含供应商、协议和配置信息。从代码实现看：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ChannelRepo.java</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ChannelRepo</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StatusRepo</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ChannelDB</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token generics"></span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ChannelRecord</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AutogenCodeRepo</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ChannelRecord</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 支持价格信息查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Map</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">queryPriceInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">List</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">entityCodes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 支持供应商列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">List</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">listSuppliers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">selectDistinct</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CHANNEL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">SUPPLIER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CHANNEL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fetchInto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 支持多种过滤条件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SelectSeekStep1</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ChannelRecord</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Long</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">constructSql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Condition</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">ChannelCondition</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 供应商、协议、优先级、目标等多维度条件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>从 EndpointContext.java 中，我们可以看到 Channel 在实际调用中的作用：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setEndpointData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">ChannelDB</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setEndpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setModel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setChannelCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getChannelCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setForwardUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setProtocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProtocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPriceInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getPriceInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">EndpointContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getProcessData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setSupplier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getSupplier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>核心设计特点：</p>
<ul>
<li>多实体支持: 提供了能力点/  模型两种实体类型，提供了灵活的绑定方式，既可以通过模型请求，也可以不指定模型直接通过能力点请求</li>
<li>多供应商支持：可以配置不同的 AI 服务提供商</li>
<li>协议封装：抽象不同服务商的 API 差异，提供统一接口</li>
<li>价格管理：包含价格信息，支持计费功能</li>
<li>路由控制：通过优先级和目标设置实现智能路由</li>
</ul>
<p>这一层解决了&quot;如何灵活对接不同服务提供商&quot;的问题，使系统能够透明地管理和切换多个底层服务。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四层架构的协同工作机制">四层架构的协同工作机制<a href="#四层架构的协同工作机制" class="hash-link" aria-label="四层架构的协同工作机制的直接链接" title="四层架构的协同工作机制的直接链接" translate="no">​</a></h2>
<p>这四层架构按如下方式协同工作：</p>
<ul>
<li>类别选择：用户根据分类选择所需的 Endpoint</li>
<li>请求入口：用户通过 Endpoint 发起请求</li>
<li>模型选择：发起请求时，如果要指定模型，可在 Endpoint 下选择合适的 Model</li>
<li>通道路由：根据路由策略选择合适的 Channel</li>
<li>请求转发：将请求转发到目标服务，并处理响应</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="可扩展性分析四层架构的优势">可扩展性分析：四层架构的优势<a href="#可扩展性分析四层架构的优势" class="hash-link" aria-label="可扩展性分析：四层架构的优势的直接链接" title="可扩展性分析：四层架构的优势的直接链接" translate="no">​</a></h2>
<p>通过深入分析 Bella OpenAPI 的四层元数据架构，我们可以发现其在可扩展性方面的显著优势：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-水平扩展能力">1. 水平扩展能力<a href="#1-水平扩展能力" class="hash-link" aria-label="1. 水平扩展能力的直接链接" title="1. 水平扩展能力的直接链接" translate="no">​</a></h3>
<p>Bella OpenAPI 的四层架构使得系统可以在各个维度进行水平扩展：</p>
<ul>
<li>新增类别：可以轻松添加新的 AI 能力类别，无需修改现有结构</li>
<li>新增端点：可以为现有类别添加新的 API 能力，如新的语音处理功能</li>
<li>新增模型：可以增加新的 AI 模型支持，如集成新发布的大语言模型</li>
<li>新增通道：可以连接新的服务提供商，如对接新的云服务商</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-垂直深化能力">2. 垂直深化能力<a href="#2-垂直深化能力" class="hash-link" aria-label="2. 垂直深化能力的直接链接" title="2. 垂直深化能力的直接链接" translate="no">​</a></h3>
<p>除了水平扩展，四层架构还支持在每一层的垂直深化：</p>
<ul>
<li>类别层次：支持多级类别树，可以按需细化分类</li>
<li>端点能力：可以为端点增加新的参数和功能</li>
<li>模型特性：可以为模型添加新的属性和特性标记</li>
<li>通道配置：可以细化通道的路由策略和配置参数</li>
</ul>
<p>这种垂直深化能力使得系统可以适应各种复杂的业务需求，而不仅仅是简单的 API 转发。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-松耦合设计">3. 松耦合设计<a href="#3-松耦合设计" class="hash-link" aria-label="3. 松耦合设计的直接链接" title="3. 松耦合设计的直接链接" translate="no">​</a></h3>
<p>四层架构的一个重要特点是各层之间通过关联表（如 EndpointCategoryRel、ModelEndpointRel 等）建立多对多关系，实现了松耦合：</p>
<ul>
<li>一个类别可以包含多个端点</li>
<li>一个端点可以支持多个模型，也可以不提供模型</li>
<li>一个端点/模型可以有多个通道实现</li>
</ul>
<p>这种松耦合设计使得系统可以灵活应对变化，例如：</p>
<ul>
<li>当需要为某个端点更换底层  模型时，只需修改关联关系</li>
<li>当某个服务提供商出现问题时，可以快速切换到备用通道</li>
<li>当业务需求变化时，可以调整类别组织而不影响底层实现</li>
<li>既支持模型能力点（如 chat completions），也可以支持非模型的能力点（如 Rag）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-元数据驱动的扩展性">4. 元数据驱动的扩展性<a href="#4-元数据驱动的扩展性" class="hash-link" aria-label="4. 元数据驱动的扩展性的直接链接" title="4. 元数据驱动的扩展性的直接链接" translate="no">​</a></h3>
<p>Bella OpenAPI 的架构本质上是&quot;元数据驱动&quot;的，这意味着：</p>
<ul>
<li>大多数扩展可以通过配置元数据完成，无需修改代码</li>
<li>系统行为由元数据定义，使得扩展过程更加可控</li>
<li>可以通过 UI 界面管理元数据，扩展更便捷</li>
<li>这种元数据驱动的方式使得系统能够适应快速变化的 AI 技术环境，同时保持稳定性。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实际应用四层架构的生产环境验证">实际应用：四层架构的生产环境验证<a href="#实际应用四层架构的生产环境验证" class="hash-link" aria-label="实际应用：四层架构的生产环境验证的直接链接" title="实际应用：四层架构的生产环境验证的直接链接" translate="no">​</a></h2>
<p>Bella OpenAPI 已在贝壳找房的生产环境中得到大规模验证，日均调用量达到 1.5 亿次。这样的规模证明了四层元数据架构在实际应用中的有效性：</p>
<ul>
<li>管理多种 AI 能力点：通过类别和端点的组织</li>
<li>集成多种 AI 模型：从开源模型到商业服务</li>
<li>对接多个服务提供商：包括主流云服务和专业 AI 服务商</li>
<li>支持亿级请求调度：通过多层次的路由和调度机制</li>
</ul>
<p>这种架构不仅在功能丰富性上得到了验证，在性能和可靠性方面也经受住了考验。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实施四层架构的最佳实践">实施四层架构的最佳实践<a href="#实施四层架构的最佳实践" class="hash-link" aria-label="实施四层架构的最佳实践的直接链接" title="实施四层架构的最佳实践的直接链接" translate="no">​</a></h2>
<p>基于 Bella OpenAPI 的代码分析，我们可以总结出以下实施四层元数据架构的最佳实践：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-编码规范与命名约定">1. 编码规范与命名约定<a href="#1-编码规范与命名约定" class="hash-link" aria-label="1. 编码规范与命名约定的直接链接" title="1. 编码规范与命名约定的直接链接" translate="no">​</a></h3>
<p>确保每一层的元数据都有清晰的编码规则：</p>
<ul>
<li>Category：层级式编码，如&quot;0001-0002&quot;</li>
<li>Endpoint：使用&quot;ep-&quot;前缀和自增 ID</li>
<li>Model：使用模型名称作为唯一标识</li>
<li>Channel：使用&quot;ch-&quot;前缀和自增 ID</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-关系管理策略">2. 关系管理策略<a href="#2-关系管理策略" class="hash-link" aria-label="2. 关系管理策略的直接链接" title="2. 关系管理策略的直接链接" translate="no">​</a></h3>
<p>使用关系表管理不同层次间的关联：</p>
<ul>
<li>使用中间表存储多对多关系</li>
<li>在关系表中添加额外属性（如权重、优先级）</li>
<li>支持批量操作关系的方法</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-状态管理机制">3. 状态管理机制<a href="#3-状态管理机制" class="hash-link" aria-label="3. 状态管理机制的直接链接" title="3. 状态管理机制的直接链接" translate="no">​</a></h3>
<p>所有元数据都应有统一的状态管理：</p>
<ul>
<li>使用通用的状态字段（active/inactive）</li>
<li>实现软删除而非物理删除</li>
<li>提供状态变更的审计日志</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-扩展性设计">4. 扩展性设计<a href="#4-扩展性设计" class="hash-link" aria-label="4. 扩展性设计的直接链接" title="4. 扩展性设计的直接链接" translate="no">​</a></h3>
<p>预留足够的扩展点：</p>
<ul>
<li>使用 JSON 字段存储可变属性</li>
<li>设计通用的特性标记机制</li>
<li>支持自定义元数据属性</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语元数据驱动的未来">结语：元数据驱动的未来<a href="#结语元数据驱动的未来" class="hash-link" aria-label="结语：元数据驱动的未来的直接链接" title="结语：元数据驱动的未来的直接链接" translate="no">​</a></h2>
<p>Bella OpenAPI 的四层元数据架构不仅解决了当前 AI 网关面临的挑战，也为未来的扩展奠定了坚实基础。随着 AI 技术的发展，我们可以预见：</p>
<ul>
<li>更多类型的 AI 能力将被集成到这一架构中</li>
<li>更复杂的路由策略将基于这一架构实现</li>
<li>更智能的元数据管理将使系统更加自适应</li>
</ul>
<p>对于任何计划构建企业级 AI 能力平台的团队，Bella OpenAPI 的四层元数据架构提供了一个经过实战验证的参考模型。通过采用这种架构，企业可以构建既灵活又可控的 AI 能力网关，为业务创新提供强大支持。</p>
<p>如果您对 Bella OpenAPI 的四层元数据架构有兴趣，欢迎访问 GitHub 仓库深入研究其实现细节，或者通过线上体验版亲自体验这一架构的强大之处。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/bella-openapi/tech/system-structure"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">亿级调用背后：Bella OpenAPI 的企业级稳定性保障</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/bella-openapi/tech/dynamic-route"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">动态路由与灵活调度：Bella OpenAPI 的流量分发机制</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#引言架构设计的挑战" class="table-of-contents__link toc-highlight">引言：架构设计的挑战</a></li><li><a href="#四层元数据架构优雅的分层设计" class="table-of-contents__link toc-highlight">四层元数据架构：优雅的分层设计</a><ul><li><a href="#第一层category类别" class="table-of-contents__link toc-highlight">第一层：Category（类别）</a></li><li><a href="#第二层endpoint端点" class="table-of-contents__link toc-highlight">第二层：Endpoint（端点）</a></li><li><a href="#第四层channel通道" class="table-of-contents__link toc-highlight">第四层：Channel（通道）</a></li></ul></li><li><a href="#四层架构的协同工作机制" class="table-of-contents__link toc-highlight">四层架构的协同工作机制</a></li><li><a href="#可扩展性分析四层架构的优势" class="table-of-contents__link toc-highlight">可扩展性分析：四层架构的优势</a><ul><li><a href="#1-水平扩展能力" class="table-of-contents__link toc-highlight">1. 水平扩展能力</a></li><li><a href="#2-垂直深化能力" class="table-of-contents__link toc-highlight">2. 垂直深化能力</a></li><li><a href="#3-松耦合设计" class="table-of-contents__link toc-highlight">3. 松耦合设计</a></li><li><a href="#4-元数据驱动的扩展性" class="table-of-contents__link toc-highlight">4. 元数据驱动的扩展性</a></li></ul></li><li><a href="#实际应用四层架构的生产环境验证" class="table-of-contents__link toc-highlight">实际应用：四层架构的生产环境验证</a></li><li><a href="#实施四层架构的最佳实践" class="table-of-contents__link toc-highlight">实施四层架构的最佳实践</a><ul><li><a href="#1-编码规范与命名约定" class="table-of-contents__link toc-highlight">1. 编码规范与命名约定</a></li><li><a href="#2-关系管理策略" class="table-of-contents__link toc-highlight">2. 关系管理策略</a></li><li><a href="#3-状态管理机制" class="table-of-contents__link toc-highlight">3. 状态管理机制</a></li><li><a href="#4-扩展性设计" class="table-of-contents__link toc-highlight">4. 扩展性设计</a></li></ul></li><li><a href="#结语元数据驱动的未来" class="table-of-contents__link toc-highlight">结语：元数据驱动的未来</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">入门指南</a></li><li class="footer__item"><a class="footer__link-item" href="/api-viewer">API 文档</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/LianjiaTech/bella-openapi/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/LianjiaTech/bella-openapi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权所有 2025 LianjiaTech. 基于 Docusaurus 构建。</div></div></div></footer></div>
</body>
</html>