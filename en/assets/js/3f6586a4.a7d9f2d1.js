"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[1590],{2140:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"bella-queue/api/batch/create","title":"Create Batch Task","description":"POST http(s)://{}/v1/batches","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/bella-queue/api/batch/create.md","sourceDirName":"bella-queue/api/batch","slug":"/bella-queue/api/batch/create","permalink":"/en/docs/bella-queue/api/batch/create","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Get Event Bus Configuration","permalink":"/en/docs/bella-queue/api/queue/eventbus"},"next":{"title":"Cancel Batch Job","permalink":"/en/docs/bella-queue/api/batch/cancel"}}');var i=s(4848),r=s(8453);const l={},d="Create Batch Task",c={},o=[{value:"Example",id:"example",level:2},{value:"Request Headers",id:"request-headers",level:2},{value:"Request Body Parameters",id:"request-body-parameters",level:2},{value:"Completion Window",id:"completion-window",level:2},{value:"Returns",id:"returns",level:2},{value:"Batch Task Lifecycle",id:"batch-task-lifecycle",level:2},{value:"Job Expiration (expired)",id:"job-expiration-expired",level:3},{value:"Job Failure (failed)",id:"job-failure-failed",level:3},{value:"Input/Output File Format",id:"inputoutput-file-format",level:2},{value:"Input File",id:"input-file",level:3},{value:"Output File",id:"output-file",level:3},{value:"Error File",id:"error-file",level:3},{value:"File Download and Processing",id:"file-download-and-processing",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"create-batch-task",children:"Create Batch Task"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"http(s)://{{Host}}/v1/batches"})]}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/batches" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -H "X-BELLA-QUEUE-NAME: test-queue" \\\n  -d \'{\n    "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",\n    "endpoint": "/v1/chat/completions", \n    "completion_window": "24h",\n    "metadata": {\n      "description": "Customer support chat completions batch"\n    }\n  }\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n  "object": "batch",\n  "endpoint": "/v1/chat/completions",\n  "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",\n  "completion_window": "24h",\n  "created_at": 1762867031064,\n  "expired_at": 1762953431064,\n  "request_counts": {\n    "total": 0,\n    "completed": 0,\n    "failed": 0\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"request-headers",children:"Request Headers"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-BELLA-QUEUE-NAME"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Optional"}),(0,i.jsx)(n.td,{children:"Queue name for batch processing"})]})})]}),"\n",(0,i.jsx)(n.h2,{id:"request-body-parameters",children:"Request Body Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"input_file_id"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Required"}),(0,i.jsxs)(n.td,{children:["Input file ID containing batch requests, upload using File API, refer to ",(0,i.jsx)(n.a,{href:"/docs/bella-knowledge/api/files/upload",children:"File Upload Documentation"})," (Chinese version)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"endpoint"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Required"}),(0,i.jsx)(n.td,{children:"API endpoint for processing tasks"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"completion_window"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Required"}),(0,i.jsx)(n.td,{children:'Completion window, format: number+unit(m/h/d), default "24h"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"metadata"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsx)(n.td,{children:"Optional"}),(0,i.jsx)(n.td,{children:"Batch metadata, custom key-value pairs"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"completion-window",children:"Completion Window"}),"\n",(0,i.jsx)(n.p,{children:"Supported time unit formats:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Unit"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"m"})}),(0,i.jsx)(n.td,{children:"Minutes"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"30m"}),"(30 min)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"h"})}),(0,i.jsx)(n.td,{children:"Hours"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"24h"}),"(24 hrs)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"d"})}),(0,i.jsx)(n.td,{children:"Days"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"7d"}),"(7 days)"]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default"}),": ",(0,i.jsx)(n.code,{children:"24h"})," (24 hours)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Format"}),": number + unit, e.g., ",(0,i.jsx)(n.code,{children:"30m"}),", ",(0,i.jsx)(n.code,{children:"2h"}),", ",(0,i.jsx)(n.code,{children:"1d"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": Specifies the maximum completion time window for batch tasks. If the provided value format is\nincorrect, the system will automatically use the default value of 24h."]}),"\n",(0,i.jsx)(n.h2,{id:"returns",children:"Returns"}),"\n",(0,i.jsx)(n.p,{children:"Returns a batch object containing complete batch information and status."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": "batchId",\n  "object": "batch",\n  "endpoint": "API endpoint",\n  "input_file_id": "Input file ID",\n  "completion_window": "Specified completion time",\n  "created_at": "Creation time",\n  "expired_at": "Expiration time",\n  "request_counts": {\n    "total": "Total tasks",\n    "completed": "Completed tasks",\n    "failed": "Failed tasks"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"batch-task-lifecycle",children:"Batch Task Lifecycle"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Status"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"validating"}),(0,i.jsx)(n.td,{children:"Batch job created, system is validating input file format and content."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"in_progress"}),(0,i.jsx)(n.td,{children:"Input file validation passed, system is processing batch requests."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"finalizing"}),(0,i.jsx)(n.td,{children:"All requests processed, system is organizing and preparing output files."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"completed"}),(0,i.jsx)(n.td,{children:"Batch job successfully completed, all results ready for download."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"failed"}),(0,i.jsx)(n.td,{children:"Batch job encountered errors during processing, failed to complete."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"cancelled"}),(0,i.jsx)(n.td,{children:"Batch job has been cancelled by user."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"expired"}),(0,i.jsx)(n.td,{children:"Batch job failed to complete within time window limit, timed out."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"job-expiration-expired",children:"Job Expiration (expired)"}),"\n",(0,i.jsx)(n.p,{children:"Job expiration is a built-in protection mechanism of the Batch API, designed to prevent jobs from running indefinitely.\nEach batch job has a designated completion window."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important Note"}),": When a job expires, all uncompleted requests will be cancelled, but the results of already completed\nrequests will still be saved. Users only pay for requests that have been successfully completed."]}),"\n",(0,i.jsx)(n.h3,{id:"job-failure-failed",children:"Job Failure (failed)"}),"\n",(0,i.jsx)(n.p,{children:"Job failure typically indicates that an unrecoverable error was encountered during processing, preventing the job from\ncontinuing. Common causes include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Input file format errors"}),"\n",(0,i.jsx)(n.li,{children:"Invalid request parameters"}),"\n",(0,i.jsx)(n.li,{children:"Permission issues"}),"\n",(0,i.jsx)(n.li,{children:"Internal system errors"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"inputoutput-file-format",children:"Input/Output File Format"}),"\n",(0,i.jsx)(n.h3,{id:"input-file",children:"Input File"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File Format"}),": JSONL (JSON Lines)"]}),"\n",(0,i.jsx)(n.p,{children:"Input files are the foundation of Batch API operations, containing all API requests to be processed. To ensure batch\ntasks can be successfully created and executed, input files must strictly follow the specified format and requirements."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Format Requirements"}),": Each line is an independent, valid JSON object"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsonl",children:'{"custom_id": "request-1", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "deepseek-r1-20250401", "messages": [{"role": "user", "content": "What is the capital of France?"}]}}\n{"custom_id": "request-2", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "deepseek-r1-20250401", "messages": [{"role": "user", "content": "Translate \'Hello\' to Spanish."}]}}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Field Description"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"custom_id"}),": Business ID for correlating output results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"method"}),': HTTP method, usually "POST"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"url"}),": API endpoint path"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"body"}),": Request body containing specific API parameters, refer\nto ",(0,i.jsx)(n.a,{href:"/en/docs/bella-openapi/core/chat-completions",children:"OpenAPI documentation"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important Limitations"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All requests in a batch task must point to the same endpoint and same model; mixed models are not allowed"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"output-file",children:"Output File"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File Format"}),": JSONL (JSON Lines)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsonl",children:'{"response":{"status_code":200,"request_id":"TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX","body":{"id":"chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX","object":"chat.completion","created":1762912790,"model":"deepseek-r1-20250401","choices":[{"index":0,"message":{"role":"assistant","content":"xxx","tool_calls":[],"reasoning_content":"xxx"},"finish_reason":"stop"}],"usage":{"prompt_tokens":6295,"total_tokens":7524,"completion_tokens":1229}}},"custom_id":"XXXXXXXXXXXXXXXX_XXXXXX","id":"TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX"}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Field Description"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id"}),": Batch request ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"custom_id"}),": Corresponding custom_id from input file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"response"}),": API response result"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": Output line order may not match input line order. Don't rely on order to process results; instead use the\n",(0,i.jsx)(n.code,{children:"custom_id"})," field included in each output line to map input requests to output results."]}),"\n",(0,i.jsx)(n.h3,{id:"error-file",children:"Error File"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File Format"}),": JSONL (JSON Lines)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsonl",children:'{"id":"","error":{"code":"parse_error","message":"Failed to parse request data."},"customId":"0"}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Field Description"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id"}),": Batch request ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"custom_id"}),": Corresponding custom_id from input file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"error"}),": Detailed error information"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"file-download-and-processing",children:"File Download and Processing"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"output_file_id"})," and ",(0,i.jsx)(n.code,{children:"error_file_id"})," from the query task interface to download output files and error files from\nthe File API. Refer to ",(0,i.jsx)(n.a,{href:"/docs/bella-knowledge/api/files/content",children:"File API Documentation"})," (Chinese version)."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);