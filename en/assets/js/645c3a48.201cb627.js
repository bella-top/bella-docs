"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[9441],{198:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"bella-queue/api/worker","title":"Worker Development Integration Guide","description":"This document describes how to develop Worker services to integrate with the Bella-Queue system as downstream task processors.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/bella-queue/api/worker.md","sourceDirName":"bella-queue/api","slug":"/bella-queue/api/worker","permalink":"/en/docs/bella-queue/api/worker","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"\u4ecb\u7ecd\uff08Introduction\uff09","permalink":"/en/docs/bella-queue/intro"},"next":{"title":"Register Queue","permalink":"/en/docs/bella-queue/api/queue/register"}}');var t=s(4848),i=s(8453);const a={},o="Worker Development Integration Guide",l={},c=[{value:"Worker Development Methods",id:"worker-development-methods",level:2},{value:"1. Prerequisites: Queue and Channel Configuration",id:"1-prerequisites-queue-and-channel-configuration",level:2},{value:"1.1 Register Worker Queue",id:"11-register-worker-queue",level:3},{value:"1.2 Configure Model Channels",id:"12-configure-model-channels",level:3},{value:"1.3 Task Routing Description",id:"13-task-routing-description",level:3},{value:"Direct Queue Specification (Task API)",id:"direct-queue-specification-task-api",level:4},{value:"Batch Task Routing (Batch API)",id:"batch-task-routing-batch-api",level:4},{value:"2. Self-hosted Service Integration",id:"2-self-hosted-service-integration",level:2},{value:"2.1 Worker Service Development",id:"21-worker-service-development",level:3},{value:"2.1.1 Get System Configuration",id:"211-get-system-configuration",level:4},{value:"2.1.2 Pull Tasks",id:"212-pull-tasks",level:4},{value:"2.1.3 Process Tasks and Return Results",id:"213-process-tasks-and-return-results",level:4},{value:"Callback/Batch Mode - HTTP Interface Return",id:"callbackbatch-mode---http-interface-return",level:5},{value:"Blocking/Streaming Mode - Redis Event Return",id:"blockingstreaming-mode---redis-event-return",level:5},{value:"3. Java SDK Integration",id:"3-java-sdk-integration",level:2},{value:"3.1 Add Dependency",id:"31-add-dependency",level:3},{value:"3.2 Enable Worker",id:"32-enable-worker",level:3},{value:"3.3 Configure OpenAiService",id:"33-configure-openaiservice",level:3},{value:"3.4 Implement TaskExecutor",id:"34-implement-taskexecutor",level:3},{value:"Interface Definition",id:"interface-definition",level:4},{value:"TaskWrapper Method Description",id:"taskwrapper-method-description",level:4},{value:"Implementation Example",id:"implementation-example",level:4},{value:"3.5 Configure Worker Scheduler",id:"35-configure-worker-scheduler",level:3},{value:"Use Default ScheduledWorker",id:"use-default-scheduledworker",level:4},{value:"Configuration Parameter Description",id:"configuration-parameter-description",level:4},{value:"3.6 Custom Worker Scheduling Implementation",id:"36-custom-worker-scheduling-implementation",level:3},{value:"4. Summary",id:"4-summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"worker-development-integration-guide",children:"Worker Development Integration Guide"})}),"\n",(0,t.jsx)(n.p,{children:"This document describes how to develop Worker services to integrate with the Bella-Queue system as downstream task processors."}),"\n",(0,t.jsx)(n.h2,{id:"worker-development-methods",children:"Worker Development Methods"}),"\n",(0,t.jsx)(n.p,{children:"The system supports two Worker development methods:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Self-hosted Service Integration"}),": Independently developed HTTP services that interact with Bella-Queue through APIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Java SDK Integration"}),": Quick integration using the Java SDK provided by Bella-Queue"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"1-prerequisites-queue-and-channel-configuration",children:"1. Prerequisites: Queue and Channel Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Before developing Workers, you need to register queues and configure channel mappings in Bella-Queue."}),"\n",(0,t.jsx)(n.h3,{id:"11-register-worker-queue",children:"1.1 Register Worker Queue"}),"\n",(0,t.jsx)(n.p,{children:"Register a queue for your Worker service:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/queue/register" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -d \'{\n    "queue": "deepseek-r1",\n    "endpoint": "/v1/chat/completions"\n  }\'\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameter Description"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"queue"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"}),(0,t.jsx)(n.td,{children:"Queue name (can only contain letters, numbers, underscores, separators, max 64 characters)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"endpoint"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Required"}),(0,t.jsx)(n.td,{children:"Task processing capability point"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'"deepseek-r1"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"12-configure-model-channels",children:"1.2 Configure Model Channels"}),"\n",(0,t.jsx)(n.p,{children:"Create channels through OpenAPI to establish mapping relationships between model names and queues."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": When users use specific models, Bella-Queue will automatically route tasks to the corresponding queues based on channel configuration."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"For specific interfaces and parameters of channel configuration, please refer to the OpenAPI interface documentation."})}),"\n",(0,t.jsx)(n.h3,{id:"13-task-routing-description",children:"1.3 Task Routing Description"}),"\n",(0,t.jsx)(n.p,{children:"After configuration, Bella-Queue places tasks into corresponding queues through the following methods, and Workers pull tasks from queues for processing:"}),"\n",(0,t.jsx)(n.h4,{id:"direct-queue-specification-task-api",children:"Direct Queue Specification (Task API)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/queue/put" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -d \'{\n    "queue": "deepseek-r1",\n    "endpoint": "/v1/chat/completions",\n    "level": 1,\n    "data": {"k":"v"},\n    "callback_url": "http://localhost:8081/test/callback",\n  }\'\n'})}),"\n",(0,t.jsx)(n.h4,{id:"batch-task-routing-batch-api",children:"Batch Task Routing (Batch API)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Specify Queue"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/batches" \\\n  -H "Content-Type: application/json" \\\n  -H "X-BELLA-QUEUE-NAME: deepseek-r1" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -d \'{\n    "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",\n    "endpoint": "/v1/chat/completions", \n    "completion_window": "24h",\n    "metadata": {\n      "description": "Customer support chat completions batch"\n    }\n  }\'\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Automatic Routing"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/batches" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -d \'{\n    "input_file_id": "file-XXXXXXXXXXXXXXXXXXXXXXX-XXXXXXXXXX",\n    "endpoint": "/v1/chat/completions", \n    "completion_window": "24h",\n    "metadata": {\n      "description": "Customer support chat completions batch"\n    }\n  }\'\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsonl",children:'{"custom_id": "req-1", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "deepseek-r1", "messages": [...]}}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The system automatically finds channel configuration based on the ",(0,t.jsx)(n.code,{children:"deepseek-r1"})," model and routes to the ",(0,t.jsx)(n.code,{children:"deepseek-r1"})," queue."]}),"\n",(0,t.jsx)(n.h2,{id:"2-self-hosted-service-integration",children:"2. Self-hosted Service Integration"}),"\n",(0,t.jsx)(n.p,{children:"Suitable for scenarios with existing inference services or requirements to use other technology stacks."}),"\n",(0,t.jsx)(n.h3,{id:"21-worker-service-development",children:"2.1 Worker Service Development"}),"\n",(0,t.jsx)(n.p,{children:"Your Worker service needs to implement the following core functions:"}),"\n",(0,t.jsx)(n.h4,{id:"211-get-system-configuration",children:"2.1.1 Get System Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Get EventBus configuration for real-time task communication:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X GET "https://${Host}/v1/queue/eventbus" \\\n  -H "Authorization: Bearer ${apikey}"\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response Example"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "url": "redis://localhost:6379",\n  "topic": "bella:eventbus:"\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"212-pull-tasks",children:"2.1.2 Pull Tasks"}),"\n",(0,t.jsx)(n.p,{children:"Regularly pull pending tasks from Bella-Queue:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/queue/take" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -d \'{\n    "queues": [\n        "deepseek-r1:1"\n    ],\n    "size": 10,\n    "strategy": "fifo"\n  }\'\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response Example (Offline Queue - Batch/Callback Mode)"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "deepseek-r1:1": [\n    {\n      "ak": "xxx",\n      "endpoint": "/v1/chat/completions",\n      "queue": "test-queue",\n      "level": 1,\n      "data": {\n        "model": "deepseek-r1",\n        "messages": [\n          {\n            "role": "user",\n            "content": "Hello"\n          }\n        ],\n        "temperature": 0.7\n      },\n      "status": "waiting",\n      "task_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n      "batch_id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n      "trace_id": "BATCH-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n      "start_time": 1762863595000,\n      "running_time": 0,\n      "expire_time": 1762949994000,\n      "completed_time": 0,\n      "callback_url": "",\n      "response_mode": "batch"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response Example (Online Queue - Blocking/Streaming Mode)"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "deepseek-r1:0": [\n    {\n      "ak": "xxx",\n      "endpoint": "/v1/chat/completions",\n      "queue": "test-queue",\n      "level": 0,\n      "data": {\n        "model": "deepseek-r1",\n        "messages": [\n          {\n            "role": "user",\n            "content": "\u4f60\u597d"\n          }\n        ],\n        "stream": false\n      },\n      "task_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n      "instance_id": "xx.xx.xx.xx:xxxx",\n      "start_time": 1762950826730,\n      "running_time": 0,\n      "expire_time": 1762951126730,\n      "completed_time": 0,\n      "response_mode": "blocking"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"instanceId Description"}),": Online tasks carry an ",(0,t.jsx)(n.code,{children:"instance_id"})," field that identifies the client instance address (such as IP",":port",") that initiated the request. After processing, Workers need to send events to the corresponding instance via Redis Stream."]}),"\n",(0,t.jsx)(n.h4,{id:"213-process-tasks-and-return-results",children:"2.1.3 Process Tasks and Return Results"}),"\n",(0,t.jsxs)(n.p,{children:["Use different result return methods based on ",(0,t.jsx)(n.code,{children:"response_mode"}),":"]}),"\n",(0,t.jsx)(n.h5,{id:"callbackbatch-mode---http-interface-return",children:"Callback/Batch Mode - HTTP Interface Return"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://${Host}/v1/queue/{taskId}/complete" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ${apikey}" \\\n  -d \'{\n    "status_code": 200,\n    "request_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n    "body": {\n      // Worker processing result - chat completion response\n      "id": "chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",\n      "object": "chat.completion",\n      "model": "deepseek-r1",\n      "choices": [{\n        "message": {\n          "role": "assistant", \n          "content": "Hello! How can I help you today?"\n        }\n      }]\n    }\n  }\'\n'})}),"\n",(0,t.jsx)(n.h5,{id:"blockingstreaming-mode---redis-event-return",children:"Blocking/Streaming Mode - Redis Event Return"}),"\n",(0,t.jsxs)(n.p,{children:["Online tasks carry an ",(0,t.jsx)(n.code,{children:"instance_id"})," field. Workers need to send events to Redis Stream at: ",(0,t.jsx)(n.code,{children:"{eventbus.topic}{instance_id}"})]}),"\n",(0,t.jsxs)(n.p,{children:['For example: eventbus.topic = "bella:eventbus:", instance_id = "192.168.1.100:8080"\nSend to: ',(0,t.jsx)(n.code,{children:"bella:eventbus:192.168.1.100:8080"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Progress Event"})," (Optional, for streaming mode)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "name": "task-progress-event",\n  "from": "",\n  "payload": {\n    "taskId": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n    "eventId": "progress-1",\n    "eventName": "chunk",\n    "eventData": {\n      "delta": {\n        "content": "Hello"\n      }\n    }\n  },\n  "context": ""\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Completion Event"})," (Required)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "name": "task-completion-event",\n  "from": "",\n  "payload": {\n    "taskId": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n    "result": {\n      "status_code": 200,\n      "request_id": "TASK-X-X-X-XXXXXXXXXXXX-XXXX-XXXXXX",\n      "body": {\n        "id": "chatcmpl-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",\n        "object": "chat.completion",\n        "choices": [\n          {\n            "message": {\n              "role": "assistant",\n              "content": "Hello! How can I help you today?"\n            }\n          }\n        ]\n      }\n    }\n  },\n  "context": ""\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key Notes"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Must use the ",(0,t.jsx)(n.code,{children:"instance_id"})," from the task as the Redis Stream target"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"taskId"})," must exactly match the pulled task ID"]}),"\n",(0,t.jsx)(n.li,{children:"Completion events are required; progress events are optional only in streaming mode"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"3-java-sdk-integration",children:"3. Java SDK Integration"}),"\n",(0,t.jsx)(n.p,{children:"Suitable for Java technology stack applications, can be quickly integrated into Spring Boot projects."}),"\n",(0,t.jsx)(n.h3,{id:"31-add-dependency",children:"3.1 Add Dependency"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>top.bella</groupId>\n    <artifactId>openapi-spi</artifactId>\n    <version>1.1.68</version>\n</dependency>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"32-enable-worker",children:"3.2 Enable Worker"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@SpringBootApplication\n@EnableWorker\npublic class WorkerApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(WorkerApplication.class, args);\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"33-configure-openaiservice",children:"3.3 Configure OpenAiService"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class OpenAiConfig {\n    \n    @Value("${openai.base-url}")\n    private String baseUrl;\n    \n    @Value("${openai.token}")\n    private String token;\n    \n    @Bean\n    public OpenAiService openAiService() {\n        return new OpenAiService(token, baseUrl);\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"34-implement-taskexecutor",children:"3.4 Implement TaskExecutor"}),"\n",(0,t.jsx)(n.p,{children:"TaskExecutor is the core interface for Worker task processing, defining contracts for task submission, execution, and capacity management."}),"\n",(0,t.jsx)(n.h4,{id:"interface-definition",children:"Interface Definition"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public interface TaskExecutor {\n    /**\n     * Submit task for processing\n     * @param task Task wrapper containing task data and state management methods\n     */\n    void submit(TaskWrapper task);\n    \n    /**\n     * Return the current number of tasks that can be processed\n     * Worker can dynamically adjust the number of tasks pulled based on this parameter\n     * @return Remaining capacity, no new tasks will be pulled when returns 0\n     */\n    Integer remainingCapacity();\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"taskwrapper-method-description",children:"TaskWrapper Method Description"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getPayload()"}),": Get task data submitted from upstream (Map format)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"markComplete(Object result)"}),": Mark task as complete, pass in processing result"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"markRetryLater()"}),": Mark task for retry later"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"emitProgress()"}),": Send progress events (streaming mode)"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"implementation-example",children:"Implementation Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Component\npublic class TaskExecutorImpl implements TaskExecutor {\n    \n    @Override\n    public void submit(TaskWrapper task) {\n        try {\n            // Get task data\n            Map<String, Object> data = task.getPayload();\n            \n            // Determine task type\n            String responseMode = (String) data.get("responseMode");\n            \n            if ("streaming".equals(responseMode)) {\n                // Streaming task processing\n                Map<String, Object> result = Map.of("content", "Processing...");\n                // Send progress event\n                task.emitProgress("onProgress", "onProgress", result);\n                // If completed, mark task as complete\n                task.markComplete(Map.of());\n            } else {\n                // Other task processing\n                Object result = Map.of("result", "success");\n                // Mark task as complete\n                task.markComplete(result);\n            }\n        } catch (Exception e) {\n            // Processing failed\n            if (shouldRetry(e)) {\n                task.markRetryLater();\n            } else {\n                task.markComplete(Map.of(\n                    "error", Map.of(\n                        "message", e.getMessage(),\n                        "type", "processing_error"\n                    )\n                ));\n            }\n        }\n    }\n    \n    @Override\n    public Integer remainingCapacity() {\n        return 10;\n    }\n    \n    private boolean shouldRetry(Exception e) {\n        // Determine whether to retry\n        return false;\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"35-configure-worker-scheduler",children:"3.5 Configure Worker Scheduler"}),"\n",(0,t.jsx)(n.p,{children:"Default provides ScheduledWorker based on scheduled polling. Enable and configure scheduling parameters through configuration files."}),"\n",(0,t.jsx)(n.h4,{id:"use-default-scheduledworker",children:"Use Default ScheduledWorker"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'bella:\n  queue:\n    worker:\n      enabled: true\n      scheduled:\n        enabled: true\n        take-strategy: fifo\n        size: 10\n        queues:\n          - "my-task-queue:0"\n          - "my-task-queue:1"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"configuration-parameter-description",children:"Configuration Parameter Description"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"enabled"}),": Whether to enable ScheduledWorker scheduler"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"queues"}),': List of queues to monitor, format "queue-name',":priority",'", smaller numbers have higher priority, tasks will be pulled according to configuration order']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"size"}),": Maximum number of tasks to pull each time, actual number is the smaller value between TaskExecutor.remainingCapacity() and size"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"take-strategy"}),": Queue pull strategy","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"fifo"}),": First-in-first-out, pull tasks according to queue entry time, earlier entries have higher priority, maximum 10 tasks can be pulled"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"round_robin"}),": Round-robin mode, alternately pull from multiple queues"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"active_passive"}),": Master-slave mode, prioritize pulling from master queue, pull from backup queue when master queue has no tasks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sequential"}),": Global sequential execution, ensures only one task can run at a time per queue, avoiding concurrent competition"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"36-custom-worker-scheduling-implementation",children:"3.6 Custom Worker Scheduling Implementation"}),"\n",(0,t.jsx)(n.p,{children:"If the default ScheduledWorker doesn't meet requirements, you can reuse instantiated Worker components and customize task pulling and scheduling logic."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@Component\npublic class CustomWorkerScheduler {\n\n    @Autowired\n    private Worker worker;\n\n    @Scheduled(fixedDelay = 1000)\n    public void pullAndProcessTasks() {\n        // Custom task pulling and processing logic\n        worker.pullAndProcess();\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-summary",children:"4. Summary"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Worker is an independent service"}),": Acts as a downstream task processor for Bella-Queue"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Queue registration is prerequisite"}),": Workers need to register queues before receiving tasks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Channel configuration establishes mapping"}),": Let the system know which model tasks should be distributed to your Worker"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Support multiple response modes"}),": Choose different result return methods according to user requirements"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Two development methods"}),": Self-hosted services or Java SDK, choose according to technology stack"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(6540);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);