"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[1218],{7087:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"bella-openapi/tech/user-authorization","title":"Identity and Permissions: Bella OpenAPI\'s Authentication and Authorization System","description":"Introduction: The Importance of Enterprise-Level Security Architecture","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/bella-openapi/tech/user-authorization.md","sourceDirName":"bella-openapi/tech","slug":"/bella-openapi/tech/user-authorization","permalink":"/en/docs/bella-openapi/tech/user-authorization","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Asynchronous and High Performance: Analysis of Bella OpenAPI\'s Disruptor Log Framework","permalink":"/en/docs/bella-openapi/tech/async-performace"},"next":{"title":"Billing and Quotas: Bella OpenAPI\'s Resource Management Mechanism","permalink":"/en/docs/bella-openapi/tech/usage-manage"}}');var a=i(4848),s=i(8453);const r={},o="Identity and Permissions: Bella OpenAPI's Authentication and Authorization System",l={},c=[{value:"Introduction: The Importance of Enterprise-Level Security Architecture",id:"introduction-the-importance-of-enterprise-level-security-architecture",level:2},{value:"Diverse Authentication Mechanisms",id:"diverse-authentication-mechanisms",level:2},{value:"1. API Key Authentication",id:"1-api-key-authentication",level:3},{value:"2. OAuth Authentication and CAS Support",id:"2-oauth-authentication-and-cas-support",level:3},{value:"3. Parent-Child Relationship Design",id:"3-parent-child-relationship-design",level:3},{value:"4. Permission Inheritance and Constraints",id:"4-permission-inheritance-and-constraints",level:3},{value:"Multi-Dimensional Authorization Control",id:"multi-dimensional-authorization-control",level:2},{value:"1. Path-Based Access Control",id:"1-path-based-access-control",level:3},{value:"2. Ownership Type Distinction",id:"2-ownership-type-distinction",level:3},{value:"Security Levels and Data Protection",id:"security-levels-and-data-protection",level:2},{value:"Resource Quotas and Usage Monitoring",id:"resource-quotas-and-usage-monitoring",level:2},{value:"Usage Query",id:"usage-query",level:3},{value:"High-Performance Design",id:"high-performance-design",level:2},{value:"1. Multi-Level Caching Strategy",id:"1-multi-level-caching-strategy",level:3},{value:"2. Asynchronous Processing",id:"2-asynchronous-processing",level:3},{value:"Application Value",id:"application-value",level:2},{value:"1. Security and Compliance",id:"1-security-and-compliance",level:3},{value:"2. Management Efficiency",id:"2-management-efficiency",level:3},{value:"3. System Integration",id:"3-system-integration",level:3},{value:"Best Practices and Implementation Recommendations",id:"best-practices-and-implementation-recommendations",level:2},{value:"1. API Key Management Strategy",id:"1-api-key-management-strategy",level:3},{value:"2. Security Level Planning",id:"2-security-level-planning",level:3},{value:"3. Resource Quota Optimization",id:"3-resource-quota-optimization",level:3},{value:"Conclusion: Balancing Security and Convenience",id:"conclusion-balancing-security-and-convenience",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"identity-and-permissions-bella-openapis-authentication-and-authorization-system",children:"Identity and Permissions: Bella OpenAPI's Authentication and Authorization System"})}),"\n",(0,a.jsx)(n.h2,{id:"introduction-the-importance-of-enterprise-level-security-architecture",children:"Introduction: The Importance of Enterprise-Level Security Architecture"}),"\n",(0,a.jsx)(n.p,{children:"In today's era of widespread AI services, API gateways must not only provide rich functionality but also establish strict identity authentication and access control mechanisms to ensure enterprise data security and compliant use. Bella OpenAPI successfully addresses this challenge through its multi-layered authentication and authorization system. This article will delve into the core design and implementation details of Bella OpenAPI's identity and permission management based on an in-depth analysis of its source code."}),"\n",(0,a.jsx)(n.h2,{id:"diverse-authentication-mechanisms",children:"Diverse Authentication Mechanisms"}),"\n",(0,a.jsx)(n.p,{children:"Through analysis of Bella OpenAPI's source code, we find that the system supports multiple authentication methods to meet the needs of different usage scenarios:"}),"\n",(0,a.jsx)(n.h3,{id:"1-api-key-authentication",children:"1. API Key Authentication"}),"\n",(0,a.jsx)(n.p,{children:"API Key authentication is the core authentication mechanism of Bella OpenAPI, particularly suitable for system integration and automation scenarios:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// LoginFilter.java\nif(StringUtils.isNotBlank(properties.getAuthorizationHeader())) {\n String auth = \nhttpRequest.getHeader(properties.getAuthorizationHeader());\n if(StringUtils.isNotBlank(auth)) {\n chain.doFilter(request, response);\n return;\n }\n}\n// ApikeyService.java\npublic ApikeyInfo verifyAuth(String auth) {\n String ak;\n if(auth.startsWith("Bearer ")) {\n ak = auth.substring(7);\n } else {\n ak = auth;\n }\n String sha = EncryptUtils.sha256(ak);\n ApikeyInfo info = queryBySha(sha, true);\n // ...\u9a8c\u8bc1\u903b\u8f91\n return info;\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"The system uses the Bearer Token format to transmit API Keys, mainly used for API call scenarios, and stores them using SHA-256 hashing to ensure that even in the event of a database leak, the original key will not be exposed."}),"\n",(0,a.jsx)(n.h3,{id:"2-oauth-authentication-and-cas-support",children:"2. OAuth Authentication and CAS Support"}),"\n",(0,a.jsx)(n.p,{children:"For web interaction scenarios, the system supports OAuth 2.0 authentication flows and integrates multiple identity providers, while also supporting the connection of enterprise CAS services:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// ProviderConditional.java\n@ConditionalOnOAuthEnable\n@Conditional(ConditionalOnGoogleAuthEnable.GoogleAuthEnableCondition.class)\npublic @interface ConditionalOnGoogleAuthEnable {\n // Google OAuth \u6761\u4ef6\u5224\u5b9a\n}\n@ConditionalOnOAuthEnable\n@Conditional(ConditionalOnGithubAuthEnable.GithubAuthEnableCondition.class)\npublic @interface ConditionalOnGithubAuthEnable {\n // Github OAuth \u6761\u4ef6\u5224\u5b9a\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-parent-child-relationship-design",children:"3. Parent-Child Relationship Design"}),"\n",(0,a.jsx)(n.p,{children:"Through this parent-child relationship design, enterprise-level users can create sub-keys with different permission scopes, assign them to different teams or external partners, and ensure that each key can only access necessary resources."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// ApikeyService.java\n@Transactional\npublic String createByParentCode(ApikeyCreateOp op) {\n ApikeyInfo apikey = EndpointContext.getApikey();\n if(!apikey.getCode().equals(op.getParentCode())) {\n throw new ChannelException.AuthorizationException("\u6ca1\u6709\u64cd\u4f5c\u6743\u9650");\n }\n // \u9a8c\u8bc1\u914d\u989d\u548c\u5b89\u5168\u7ea7\u522b\n Assert.isTrue(op.getMonthQuota() == null || \nop.getMonthQuota().doubleValue() <= \napikey.getMonthQuota().doubleValue(), "\u914d\u989d\u8d85\u51fa ak \u7684\u6700\u5927\u914d\u989d");\n Assert.isTrue(op.getSafetyLevel() <= apikey.getSafetyLevel(), \n"\u5b89\u5168\u7b49\u7ea7\u8d85\u51fa ak \u7684\u6700\u9ad8\u7b49\u7ea7");\n \n // \u521b\u5efa\u5b50\u5bc6\u94a5\n // ...\n \n // \u9a8c\u8bc1\u6743\u9650\u8303\u56f4\n if(CollectionUtils.isNotEmpty(op.getPaths())) {\n boolean match = op.getPaths().stream().allMatch(url -> \napikey.getRolePath().getIncluded().stream().anyMatch(pattern -> \nMatchUtils.matchUrl(pattern, url))\n && \napikey.getRolePath().getExcluded().stream().noneMatch(pattern -> \nMatchUtils.matchUrl(pattern, url)));\n Assert.isTrue(match, "\u8d85\u51fa ak \u7684\u6743\u9650\u8303\u56f4");\n // ...\n }\n return ak;\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"4-permission-inheritance-and-constraints",children:"4. Permission Inheritance and Constraints"}),"\n",(0,a.jsx)(n.p,{children:"The permissions of sub-keys are strictly constrained by their parent keys, reflected in multiple dimensions:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Path access constraints: The access paths of sub-keys must be a subset of their parent key's access paths"}),"\n",(0,a.jsx)(n.li,{children:"Quota constraints: The monthly quota of sub-keys cannot exceed that of their parent key"}),"\n",(0,a.jsx)(n.li,{children:"Security level constraints: The security level of sub-keys cannot be higher than that of their parent key"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This design ensures the security of the permission delegation process, preventing the bypassing of permission restrictions through the creation of sub-keys."}),"\n",(0,a.jsx)(n.h2,{id:"multi-dimensional-authorization-control",children:"Multi-Dimensional Authorization Control"}),"\n",(0,a.jsx)(n.p,{children:"Bella OpenAPI implements a multi-dimensional authorization control mechanism to ensure fine-grained permission management:"}),"\n",(0,a.jsx)(n.h3,{id:"1-path-based-access-control",children:"1. Path-Based Access Control"}),"\n",(0,a.jsx)(n.p,{children:"The system uses a dual mechanism of included paths and excluded paths to implement precise URL access control. This design allows administrators to flexibly define access scopes using wildcard patterns."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// ApikeyInfo.java\npublic boolean hasPermission(String url) {\n return getRolePath().getIncluded().stream().anyMatch(pattern \n-> MatchUtils.matchUrl(pattern, url))\n && \ngetRolePath().getExcluded().stream().noneMatch(pattern -> \nMatchUtils.matchUrl(pattern, url));\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-ownership-type-distinction",children:"2. Ownership Type Distinction"}),"\n",(0,a.jsx)(n.p,{children:"The system distinguishes between different ownership types (personal, organizational, system) and implements different permission strategies accordingly, meeting the permission management needs of enterprises at different levels."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// ApikeyInfo.java\nprivate String ownerType;\nprivate String ownerCode;\nprivate String ownerName;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"security-levels-and-data-protection",children:"Security Levels and Data Protection"}),"\n",(0,a.jsx)(n.p,{children:"Bella OpenAPI introduces the concept of security levels to implement compliant control of data flow:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// ChannelRouter.java (\u53c2\u8003\u4e4b\u524d\u7684\u5206\u6790)\nprivate Byte getSafetyLevelLimit(String dataDestination) {\n switch (dataDestination) {\n case EntityConstants.PROTECTED:\n return 10;\n case EntityConstants.INNER:\n return 20;\n case EntityConstants.MAINLAND:\n return 30;\n case EntityConstants.OVERSEAS:\n return 40;\n }\n return 40;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Different data flows require different security levels, ensuring that sensitive data only flows to compliant destinations:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Already filed (PROTECTED): Minimum security requirements, level 10"}),"\n",(0,a.jsx)(n.li,{children:"Internal (INNER): Moderate security requirements, level 20"}),"\n",(0,a.jsx)(n.li,{children:"Mainland (MAINLAND): Higher security requirements, level 30"}),"\n",(0,a.jsx)(n.li,{children:"Overseas (OVERSEAS): Highest security requirements, level 40"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This mechanism is particularly important for enterprise users."}),"\n",(0,a.jsx)(n.h2,{id:"resource-quotas-and-usage-monitoring",children:"Resource Quotas and Usage Monitoring"}),"\n",(0,a.jsx)(n.p,{children:"Bella OpenAPI implements a comprehensive resource quota and usage monitoring mechanism:"}),"\n",(0,a.jsx)(n.h3,{id:"usage-query",children:"Usage Query"}),"\n",(0,a.jsx)(n.p,{children:"The system provides a convenient usage query interface, allowing enterprises to analyze API usage and optimize resource allocation."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// ApikeyService.java\npublic List<ApikeyMonthCostDB> queryBillingsByAkCode(String \nakCode) {\n return apikeyCostRepo.queryByAkCode(akCode);\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"high-performance-design",children:"High-Performance Design"}),"\n",(0,a.jsx)(n.p,{children:"Bella OpenAPI's authentication and authorization system considers performance factors while ensuring security:"}),"\n",(0,a.jsx)(n.h3,{id:"1-multi-level-caching-strategy",children:"1. Multi-Level Caching Strategy"}),"\n",(0,a.jsx)(n.p,{children:"The system employs a multi-level caching strategy combining local and distributed caching, significantly reducing the latency of authentication operations:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// ApikeyService.java\n@PostConstruct\npublic void postConstruct() {\n QuickConfig quickConfig = \nQuickConfig.newBuilder(apikeyCacheKey)\n .cacheNullValue(true)\n .cacheType(CacheType.LOCAL)\n .expire(Duration.ofSeconds(30))\n .localExpire(Duration.ofSeconds(30))\n .localLimit(500)\n .penetrationProtect(true)\n .penetrationProtectTimeout(Duration.ofSeconds(10))\n .build();\n cacheManager.getOrCreateCache(quickConfig);\n}\n@Cached(name = "apikey:cost:month:", key = "#akCode + \':\' + \n#month", expire = 31 * 24 * 3600,\n condition = \n"T(com.ke.bella.openapi.utils.DateTimeUtils).isCurrentMonth(#month)")\n@CachePenetrationProtect(timeout = 5)\npublic BigDecimal loadCost(String akCode, String month) {\n BigDecimal amount = apikeyCostRepo.queryCost(akCode, month);\n return amount == null ? BigDecimal.ZERO : amount;\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"The system employs a multi-level caching strategy combining local and distributed caching, significantly reducing the latency of authentication operations:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"API Key validation results are cached for 30 seconds, reducing database pressure from frequent authentication"}),"\n",(0,a.jsx)(n.li,{children:"Usage statistics data employs different caching strategies based on time sensitivity"}),"\n",(0,a.jsx)(n.li,{children:"Cache penetration protection mechanisms ensure system stability under high concurrency"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-asynchronous-processing",children:"2. Asynchronous Processing"}),"\n",(0,a.jsx)(n.p,{children:"Time-consuming operations in the system (such as recording usage, updating rate limiting counters) are processed asynchronously, without affecting the response time of the main request flow."}),"\n",(0,a.jsx)(n.h2,{id:"application-value",children:"Application Value"}),"\n",(0,a.jsx)(n.p,{children:"Based on our analysis of Bella OpenAPI's authentication and authorization system, we can summarize its core value in enterprise applications:"}),"\n",(0,a.jsx)(n.h3,{id:"1-security-and-compliance",children:"1. Security and Compliance"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Data sovereignty protection: Ensures compliant use of sensitive data through security levels and data flow control"}),"\n",(0,a.jsx)(n.li,{children:"Precise access control: Path-based fine-grained permissions ensure the principle of minimal resource access"}),"\n",(0,a.jsx)(n.li,{children:"Identity verification reliability: Multiple authentication mechanisms and secure key storage ensure reliable identity verification"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-management-efficiency",children:"2. Management Efficiency"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Hierarchical management: Simplifies large-scale permission management through parent-child key relationships"}),"\n",(0,a.jsx)(n.li,{children:"Resource visualization: Usage monitoring and quota management provide transparency in resource utilization"}),"\n",(0,a.jsx)(n.li,{children:"Flexible authorization: Supports the combined use of predefined roles and custom permission paths"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-system-integration",children:"3. System Integration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Diverse authentication support: Simultaneously supports API Key, OAuth, and CAS, adapting to different integration scenarios"}),"\n",(0,a.jsx)(n.li,{children:"High-performance design: Caching and asynchronous processing ensure efficient execution of authentication and authorization operations"}),"\n",(0,a.jsx)(n.li,{children:"Extensible interfaces: Provides complete API Key management interfaces, facilitating integration with existing enterprise systems"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"best-practices-and-implementation-recommendations",children:"Best Practices and Implementation Recommendations"}),"\n",(0,a.jsx)(n.p,{children:"Based on our analysis of Bella OpenAPI's source code, we can extract the following implementation recommendations:"}),"\n",(0,a.jsx)(n.h3,{id:"1-api-key-management-strategy",children:"1. API Key Management Strategy"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Master key isolation: Create independent master keys for different business lines to avoid single points of failure"}),"\n",(0,a.jsx)(n.li,{children:"Regular rotation: Utilize the reset function to periodically update API Keys, reducing long-term exposure risks"}),"\n",(0,a.jsx)(n.li,{children:"Minimal privilege allocation: When creating sub-keys, only grant the minimum permissions required to complete specific tasks"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-security-level-planning",children:"2. Security Level Planning"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Data classification mapping: Establish mapping relationships between enterprise data classification standards and security levels"}),"\n",(0,a.jsx)(n.li,{children:"Regional compliance considerations: Consider data compliance requirements in different regions and set data flow constraints accordingly"}),"\n",(0,a.jsx)(n.li,{children:"Regular security audits: Periodically review key security level settings to ensure alignment with current business needs"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-resource-quota-optimization",children:"3. Resource Quota Optimization"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Based on historical usage: Analyze historical usage patterns to set reasonable quotas for different business lines"}),"\n",(0,a.jsx)(n.li,{children:"Tiered allocation: Start with small quotas and gradually increase based on actual needs, avoiding resource waste"}),"\n",(0,a.jsx)(n.li,{children:"High-priority guarantees: Reserve sufficient quotas for critical business operations to ensure priority service during resource constraints"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"conclusion-balancing-security-and-convenience",children:"Conclusion: Balancing Security and Convenience"}),"\n",(0,a.jsx)(n.p,{children:"Bella OpenAPI's authentication and authorization system demonstrates how a mature API gateway can achieve a balance between security and usability. Through multi-layered authentication, hierarchical key management, fine-grained permission control, and efficient performance optimization, the system meets both the strict security requirements of enterprise applications and provides a flexible, convenient user experience."}),"\n",(0,a.jsx)(n.p,{children:"For enterprises planning to build their own AI capability gateway, Bella OpenAPI's authentication and authorization design provides a battle-tested reference model. Through similar design, enterprise users can ensure data security and compliance while opening up AI capabilities, laying the foundation for the healthy development of AI applications."}),"\n",(0,a.jsx)(n.p,{children:"If you are interested in Bella OpenAPI's authentication and authorization system, we welcome you to visit the GitHub repository to explore its implementation details, or experience the power of this system through the online demo version."})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var t=i(6540);const a={},s=t.createContext(a);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);